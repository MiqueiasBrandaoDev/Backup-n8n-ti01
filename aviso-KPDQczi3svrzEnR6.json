{"updatedAt":"2025-05-16T16:26:51.223Z","createdAt":"2025-05-12T20:33:34.371Z","id":"KPDQczi3svrzEnR6","name":"Aviso","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"4f998fdf-2e5c-4ef6-9694-34cf50aa66bd","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-400,-60],"id":"73e19710-324b-491a-89e7-4f372b2e918a","name":"Webhook","webhookId":"4f998fdf-2e5c-4ef6-9694-34cf50aa66bd"},{"parameters":{"promptType":"define","text":"={{ $('Webhook').item.json.body.data.message.conversation }}","options":{"systemMessage":"=Você é um agente agendador de tarefas da Camozzi Consultoria. Seu papel é entender se houve na conversa alguma solicitação de lembrete, como 'me lembre' e identificar o dia que foi pedido para lembrar.\nO usuário não pode responder qualquer mensagem, então ele nao vai poder interagir a perguntas.\n\nVocê vai entender e salvar o assunto, executor. Se for falado proxima terça\n\nHoje é {{ $now }}\n\nna coluna executor, salve a informação: {{ $('Webhook').item.json.body.data.key.participant }}\n\nUse a tool #MYSQL para guardar as informações do evento marcado."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[540,-60],"id":"0e54682e-d8e8-4ea4-a75e-d45069b5d819","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[500,140],"id":"26fbef47-bd21-452f-9f22-30af3e67df53","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM `usuarios`\n  WHERE `instancia` = \"{{ $json.body.data.instanceId }}\"\n  AND `agendamento` = 1;","options":{}},"type":"n8n-nodes-base.mySql","typeVersion":2.4,"position":[60,-60],"id":"2acf9fbc-ba79-4d22-9101-ae05ad65a595","name":"GET USUARIO","credentials":{"mySql":{"id":"baCaDIho0XdcR8ql","name":"MySQL account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d4cb70a9-f77b-4673-9e62-e5ee4683194a","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[300,-60],"id":"91d52029-62a5-4437-a28d-54f9bdeb49cf","name":"Se usuario tem agendamento"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3166b1f7-954f-42c4-963e-4dbac8c1c902","leftValue":"={{ $json.body.data.message.conversation }}","rightValue":"/agendar","operator":{"type":"string","operation":"contains"}},{"id":"9ae0b2d1-ba6f-4c42-ba75-1f0a23884a7a","leftValue":"={{ $json.body.data.message.conversation }}","rightValue":"/agendamento","operator":{"type":"string","operation":"contains"}}],"combinator":"or"},"looseTypeValidation":"={{ false }}","options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-180,-60],"id":"3fbf8d39-08ee-4a2e-83e7-38af265f603b","name":"Se é mensagem de agendamento"},{"parameters":{"table":{"__rl":true,"value":"eventos","mode":"list","cachedResultName":"eventos"},"dataMode":"defineBelow","valuesToSend":{"values":[{"column":"nome-evento","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Value', ``, 'string') }}"},{"column":"executor","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Value', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.mySqlTool","typeVersion":2.4,"position":[740,160],"id":"7b262f27-9e1f-418f-85d3-4ee819930761","name":"MySQL","credentials":{"mySql":{"id":"baCaDIho0XdcR8ql","name":"MySQL account"}}}],"connections":{"Webhook":{"main":[[{"node":"Se é mensagem de agendamento","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"GET USUARIO":{"main":[[{"node":"Se usuario tem agendamento","type":"main","index":0}]]},"Se é mensagem de agendamento":{"main":[[{"node":"GET USUARIO","type":"main","index":0}]]},"Se usuario tem agendamento":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"MySQL":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"America/Sao_Paulo","callerPolicy":"workflowsFromSameOwner"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a71ddd54-9361-4d90-80af-8029f64dc12f","activeVersionId":null,"triggerCount":1,"shared":[{"updatedAt":"2025-05-12T20:33:34.371Z","createdAt":"2025-05-12T20:33:34.371Z","role":"workflow:owner","workflowId":"KPDQczi3svrzEnR6","projectId":"BlSED80HESP48veq"}],"activeVersion":null,"tags":[{"updatedAt":"2025-05-12T20:56:02.842Z","createdAt":"2025-05-12T20:56:02.842Z","id":"USqq5KmzK8jrqoH6","name":"OPS"}]}