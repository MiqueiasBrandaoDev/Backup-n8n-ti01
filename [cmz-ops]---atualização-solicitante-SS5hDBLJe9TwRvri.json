{"updatedAt":"2025-09-01T18:53:46.364Z","createdAt":"2025-09-01T16:26:29.874Z","id":"SS5hDBLJe9TwRvri","name":"[Cmz-ops] - Atualização Solicitante","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,-304],"id":"d7b9db7a-bbd9-443e-a35e-24f95f1db2a5","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/feee9889-2b56-4af3-beb5-23a0cf938688","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,-304],"id":"f4c95611-5cd7-46f0-bec3-c09aebe69657","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) — RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = 'feee9889-2b56-4af3-beb5-23a0cf938688'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'cmz_solicitante';                         // nome do campo (mantém)\nconst UNIQUE_NAME = 'Não Cadastrado';                        // única opção que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da opção\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,-304],"id":"05c7e05f-3e65-430f-94f3-c4b226dd20a5","name":"Code Reset1"},{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/52/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-528],"id":"2870cb08-45ec-4197-87e5-c8b0bdf92da2","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-720],"id":"0118ea74-0491-4646-99b3-99e98b6b3d50","name":"All Clients"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-576],"id":"6b142e45-3cdd-4829-85bc-08f59c22c918","name":"ultimo cliente id1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-576],"id":"723985cb-9261-4294-a6db-077112810420","name":"Loop Over Items1"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/feee9889-2b56-4af3-beb5-23a0cf938688","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-720],"id":"cdfff1e7-743c-4268-be9c-ebb45a43a951","name":"List Clientes - Cognito4","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/feee9889-2b56-4af3-beb5-23a0cf938688","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[976,-816],"id":"05740886-7962-4004-ae7f-dbd010b4e88d","name":"List Clientes - Cognito5"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas opções\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// opções já existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia RazãoSocial (com alguns aliases de segurança)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['Solicitante'] ??\n    i.json?.Solicitante ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[752,-816],"id":"a275d7ac-f392-44a6-b6ac-bc3761c9d828","name":"Code1"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-768],"typeVersion":1,"id":"e834427b-d359-4509-9852-9e54fbb409af","name":"Sticky Note1"},{"parameters":{"httpMethod":"POST","path":"a984ce94-b0bc-8902-95a70ecf0f3e-4e14","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-576],"id":"2ffb3492-0aa3-4de1-b402-410320ff6f54","name":"Webhook1","webhookId":"a984ce94-b0bc-4e14-8902-95a70ecf0f3e"},{"parameters":{"workflowId":{"__rl":true,"value":"qRNjZyWsJqu8li3F","mode":"list","cachedResultName":"[Cmz-ops] - Notificação de Erro"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[976,-624],"id":"60ef0ec6-230f-4742-997b-1c6cde7a4660","name":"Execute Workflow1","executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"870401ad-d8d1-48a3-9aca-e183adc753ec","name":"json","value":"={{ $workflow }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[752,-624],"id":"2af9e8b3-ab75-4c19-ad26-70c99d712a10","name":"Edit Fields1","executeOnce":true},{"parameters":{"resource":"list","team":"3052532","space":"90139711046","folder":"901312347380","list":"901318700690"},"type":"n8n-nodes-base.clickUp","typeVersion":1,"position":[-592,-80],"id":"7de0deb7-aded-4729-91dd-f18d328a7fa3","name":"Get custom fields from a list","credentials":{"clickUpApi":{"id":"Ojf4svHZEpjVSlYw","name":"ClickUp Miqueias"}}},{"parameters":{"jsCode":"const MIN_ID = 5; // <<< ajuste aqui se precisar\nconst lastId = Number($input.first().json[\"entrie-id\"] ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"a812e10e-5ceb-49e8-a45d-f790f6ba13fc","name":"Code - Gerar IDs (lastId → 0)","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-576]}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito4","type":"main","index":0}]]},"ultimo cliente id1":{"main":[[{"node":"Code - Gerar IDs (lastId → 0)","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito4":{"main":[[{"node":"Code1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"List Clientes - Cognito5","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"ultimo cliente id1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}]]},"Code - Gerar IDs (lastId → 0)":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"global":{"results":[],"failed":[{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null}]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook1":[{"json":{"headers":{"host":"primary-production-70c40.up.railway.app","user-agent":"CognitoForms","content-length":"1260","content-type":"application/json","expect":"100-continue","request-id":"|e7b85ab3-1803-4cad-ac10-ea4b9439106a.f42a05e765e56f01.","traceparent":"00-e540803c0f45e14e62ba859dfdd9b5a3-f42a05e765e56f01-00","x-forwarded-for":"4.156.104.40","x-forwarded-host":"primary-production-70c40.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4-eqdc4a","x-railway-request-id":"7evK5laGS0Gb-K0JPvyhXg","x-real-ip":"4.156.104.40","x-request-start":"1756744426496","x-requested-with":"XMLHttpRequest","accept-encoding":"gzip"},"params":{},"query":{},"body":{"Form":{"Id":"52","InternalName":"Solicitantes","Name":"Solicitantes"},"Solicitante":"teste-2","Cliente":{"Id":"51-43","Label":"CAMOZZI CONSULTORIA E TREINAMENTO LTDA"},"Entry":{"AdminLink":"https://www.cognitoforms.com/CláudioCamozzi/52/entries/415","DateCreated":"2025-09-01T16:33:45.383Z","DateSubmitted":"2025-09-01T16:33:45.383Z","DateUpdated":"2025-09-01T16:33:45.383Z","Number":415,"Order":null,"Origin":{"City":null,"CountryCode":null,"IpAddress":"187.58.58.203","IsImported":false,"Region":null,"Timezone":null,"UserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36"},"Timestamp":"2025-09-01T16:33:45.383Z","User":null,"Version":1,"Action":"Submeter","Role":"Public","Status":"Submitted","PublicLink":"https://www.cognitoforms.com/CláudioCamozzi/Solicitantes#a56_BfbDIQ8oIr068oP94VZcOYiKWv4SmH7oeiDqgWE$*","InternalLink":"https://www.cognitoforms.com/CláudioCamozzi/Solicitantes#nzKVvk4uAap7W2zqW_R00QiZumbRcp1LLqo56UElSA4$*","Document1":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=fJkI7k6tFbzFlmoSIBr_H8KDVPqwsd0AGZ6UJ-aMPw8$","Document2":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=_qizXDcQVitLiorH-ZL5L9I3e8SacuTCFIQevwf1W_Q$"},"Id":"52-415"},"webhookUrl":"https://primary-production-70c40.up.railway.app/webhook/a984ce94-b0bc-8902-95a70ecf0f3e-4e14","executionMode":"production"}}],"List Clientes - Cognito":[{"json":{"Form":{"Id":"52","InternalName":"Solicitantes","Name":"Solicitantes"},"Solicitante":"teste-2","Cliente":{"Id":"51-43","Label":"CAMOZZI CONSULTORIA E TREINAMENTO LTDA"},"Entry":{"AdminLink":"https://www.cognitoforms.com/CláudioCamozzi/52/entries/415","DateCreated":"2025-09-01T16:33:45.383Z","DateSubmitted":"2025-09-01T16:33:45.383Z","DateUpdated":"2025-09-01T16:33:45.383Z","Number":415,"Order":null,"Timestamp":"2025-09-01T16:33:45.383Z","User":null,"Version":1,"Action":null,"Role":null,"Status":"Submitted","PublicLink":"https://www.cognitoforms.com/CláudioCamozzi/Solicitantes#a56_BfbDIQ8oIr068oP94VZcOYiKWv4SmH7oeiDqgWE$*","InternalLink":"https://www.cognitoforms.com/CláudioCamozzi/Solicitantes#nzKVvk4uAap7W2zqW_R00QiZumbRcp1LLqo56UElSA4$*","Document1":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=KsfegUWpPZBDH0Pg228yW33v9sOxP-jrOoh-2MOGe7g$","Document2":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=sVru98cxfpCXHntL3vcCpV6aXW8RZZ45ZtAMsKtGafA$"},"Id":"52-415"}}]},"versionId":"b467bbc2-8438-429b-b53f-64e76e7be8e8","activeVersionId":"b467bbc2-8438-429b-b53f-64e76e7be8e8","triggerCount":1,"shared":[{"updatedAt":"2025-09-01T16:26:29.874Z","createdAt":"2025-09-01T16:26:29.874Z","role":"workflow:owner","workflowId":"SS5hDBLJe9TwRvri","projectId":"BlSED80HESP48veq"}],"activeVersion":{"updatedAt":"2025-12-01T11:56:54.083Z","createdAt":"2025-12-01T11:56:54.083Z","versionId":"b467bbc2-8438-429b-b53f-64e76e7be8e8","workflowId":"SS5hDBLJe9TwRvri","nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,-304],"id":"d7b9db7a-bbd9-443e-a35e-24f95f1db2a5","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/feee9889-2b56-4af3-beb5-23a0cf938688","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,-304],"id":"f4c95611-5cd7-46f0-bec3-c09aebe69657","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) — RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = 'feee9889-2b56-4af3-beb5-23a0cf938688'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'cmz_solicitante';                         // nome do campo (mantém)\nconst UNIQUE_NAME = 'Não Cadastrado';                        // única opção que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da opção\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,-304],"id":"05c7e05f-3e65-430f-94f3-c4b226dd20a5","name":"Code Reset1"},{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/52/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-528],"id":"2870cb08-45ec-4197-87e5-c8b0bdf92da2","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-720],"id":"0118ea74-0491-4646-99b3-99e98b6b3d50","name":"All Clients"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-576],"id":"6b142e45-3cdd-4829-85bc-08f59c22c918","name":"ultimo cliente id1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-576],"id":"723985cb-9261-4294-a6db-077112810420","name":"Loop Over Items1"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/feee9889-2b56-4af3-beb5-23a0cf938688","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-720],"id":"cdfff1e7-743c-4268-be9c-ebb45a43a951","name":"List Clientes - Cognito4","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/feee9889-2b56-4af3-beb5-23a0cf938688","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[976,-816],"id":"05740886-7962-4004-ae7f-dbd010b4e88d","name":"List Clientes - Cognito5"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas opções\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// opções já existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia RazãoSocial (com alguns aliases de segurança)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['Solicitante'] ??\n    i.json?.Solicitante ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[752,-816],"id":"a275d7ac-f392-44a6-b6ac-bc3761c9d828","name":"Code1"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-768],"typeVersion":1,"id":"e834427b-d359-4509-9852-9e54fbb409af","name":"Sticky Note1"},{"parameters":{"httpMethod":"POST","path":"a984ce94-b0bc-8902-95a70ecf0f3e-4e14","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-576],"id":"2ffb3492-0aa3-4de1-b402-410320ff6f54","name":"Webhook1","webhookId":"a984ce94-b0bc-4e14-8902-95a70ecf0f3e"},{"parameters":{"workflowId":{"__rl":true,"value":"qRNjZyWsJqu8li3F","mode":"list","cachedResultName":"[Cmz-ops] - Notificação de Erro"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[976,-624],"id":"60ef0ec6-230f-4742-997b-1c6cde7a4660","name":"Execute Workflow1","executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"870401ad-d8d1-48a3-9aca-e183adc753ec","name":"json","value":"={{ $workflow }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[752,-624],"id":"2af9e8b3-ab75-4c19-ad26-70c99d712a10","name":"Edit Fields1","executeOnce":true},{"parameters":{"resource":"list","team":"3052532","space":"90139711046","folder":"901312347380","list":"901318700690"},"type":"n8n-nodes-base.clickUp","typeVersion":1,"position":[-592,-80],"id":"7de0deb7-aded-4729-91dd-f18d328a7fa3","name":"Get custom fields from a list","credentials":{"clickUpApi":{"id":"Ojf4svHZEpjVSlYw","name":"ClickUp Miqueias"}}},{"parameters":{"jsCode":"const MIN_ID = 5; // <<< ajuste aqui se precisar\nconst lastId = Number($input.first().json[\"entrie-id\"] ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"a812e10e-5ceb-49e8-a45d-f790f6ba13fc","name":"Code - Gerar IDs (lastId → 0)","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-576]}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito4","type":"main","index":0}]]},"ultimo cliente id1":{"main":[[{"node":"Code - Gerar IDs (lastId → 0)","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito4":{"main":[[{"node":"Code1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"List Clientes - Cognito5","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"ultimo cliente id1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}]]},"Code - Gerar IDs (lastId → 0)":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}