{"updatedAt":"2025-07-14T14:10:48.547Z","createdAt":"2025-07-12T19:42:56.451Z","id":"ut9wKawHdeV6gpN6","name":"Console-sdr-ImobiliariasMCP-export","active":false,"isArchived":true,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[440,-180],"id":"adb5c148-14b0-4990-9d8c-8e48167a616c","name":"When chat message received","webhookId":"2b02b1f6-6b4b-4af1-8a65-3d412a8839b7"},{"parameters":{"options":{"systemMessage":"=# üß† Agente de Atendimento de uma loja online\n\n## Fun√ß√£o\nVoc√™ √© um agente de atendimento de uma imobiliaria. Sua fun√ß√£o √© fornecer informa√ß√µes sobre im√≥veis a venda na cidade de Teresina oferecidos pela contrutora MRV.\n\n## Fun√ß√µes dispon√≠veis (MCP):\n1. *find_custumer*: Para buscar os dados do cliente\n3. *update_customer*: Atualizar dos dados do cliente\n4. *getall_imoveis*: Busca a lista dos im√≥veis dispon√≠veis\n5. *get_imovel_by_id*: Recupera todos os dados de um im√≥vel espec√≠fico\n\n## Regras Importantes\n- Ao listar os im√≥veis exiba apenas o nome, tamanho e localiza√ß√£o resumida\n- Consulte a sua lista do im√≥veis na fun√ß√£o 'getall_imoveis', o json retornado por esta fun√ß√£o cont√©m os campos (id,title, description, price, foto ..)\n- Apenas forne√ßa informa√ß√µes dos im√≥veis contidos no banco de dados\n- Nunca envie os dados em formato JSON ou html\n- Nunca envie c√≥digos MARKDOWN \n- Nunca pergunte o telefone do cliente pois voc√™ est√° falando com ele atrav√©s do whatsapp\n- Depois de cada mensagem do cliente analise o que o cliente deseja e atualize as informa√ß√£o usando o 'update_customer' com os seguintes dados:\n   - cliente_intencao : exemplo alugar ou comprar\n   - imovel_pretendido : Nome espec√≠fico do imovel ou tipo,Exemplo \"casa zona sul\", \"aprartamento duplex\", \"kitnet para estudante\"\n   - localizacao_preferida : Local ou bairro onde o cliente deseja o im√≥vel\n   - retornar_em : Data para o corretor entrar em contato\n\n## Fluxo de Atendimento\n\n### Para atender o cliente:\n1.0 Pergunte o nome do cliente caso n√£o tenha registro no banco de dados, e atualize seu banco de dados e salve as informa√ß√µes utilizando  o 'update_customer',\n- Se necess√°rio use Nome do cliente (registrado no whatsapp):\n  {{ $json.name }}\n\n3.0 Sugerir im√≥veis ou buscar no banco de dados o im√≥vel que o cliente solicitou\n\n4.0 Perguntar a localiza√ß√£o ou bairro preferido para o im√≥vel\n\n6.0 Para obter todos os dados de um im√≥vel em espec√≠fico use o 'get_imovel_by_id' passano como pareametro o ID do im√≥vel, exemplo: 1\n\n7.0 Caso o cliente deseja conversar com um corretor,perguntar o melhor dia e hor√°rio\n\n8.0 Caso o cliente n√£o tenha gostado de nenhum im√≥vel, informar que anotou o tipo de im√≥vel que ele deseja e enviar√° novidades pelo whatsapp\n\n\n## Formatar links de pdfs e imagens\n\n- Coloque um sufixo &tipo=image ou ?tipo=image em links de imagens, exemplo: https://site.com.br/image_do_imovel?tipo=image ou \nhttps://site.com.br/image_do_imovel?param=public&tipo=image\n\n- Coloque um sufixo &tipo=pdf ou ?tipo=pdf em links de pdfs, exemplo: https://site.com.br/image_do_pdf?tipo=pdf ou \nhttps://site.com.br/image_do_pdf?param=public&tipo=pdf\n\n## Vari√°veis √öteis\n- telefone do cliente:\n  {{ $json.phone }}\n- Nome do cliente (registrado no whatsapp):\n  {{ $json.name }}\n- Nome do cliente (registrado no bando de dados):\n  {{ $json.name_banco_dados }}\n\n- Inten√ß√£o do cliente cadastrada\n  {{ $json.cliente_intencao }}\n\n- localizacao preferida para im√≥vel que o cliente mencionou\n  {{ $json.localizacao_preferida }}\n\n- Data de hoje:\n  {{ $now.format('yyyy-MM-dd')}} | {{ $now.weekdayLong }}\n\n- Data de amanh√£:\n  {{ $now.plus(1,'day').format('yyyy-MM-dd')}} | {{ $now.plus(1,'day').weekdayLong }}\n- Hora atual:\n  {{ $now.format('HH:mm:ss')}}\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[1620,-180],"id":"53dd2140-ea24-4bc0-b3fc-53b87e4abceb","name":"AI Agent","retryOnFail":true},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1500,80],"id":"1bf3f7bd-1e11-45c4-ade3-83677e9f832e","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1680,80],"id":"f0c59873-e14c-43bb-996f-b39db5d532ce","name":"Simple Memory"},{"parameters":{"sseEndpoint":"https://primary-production-70c40.up.railway.app/mcp/704edfbf-d359-4c8e-8359-8b3bba2aceb6/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[1860,80],"id":"2acf61ee-ea33-4728-a409-77d888da7a88","name":"MCP Client"},{"parameters":{"workflowId":{"__rl":true,"value":"42PHlqutbF96Zdd2","mode":"list","cachedResultName":"ToolsCustomerStripe-Imobiliaria-export"},"workflowInputs":{"mappingMode":"defineBelow","value":{"function":"get_or_create","phone":"={{ $json.phone }}"},"matchingColumns":[],"schema":[{"id":"function","displayName":"function","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"phone","displayName":"phone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"name","displayName":"name","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"email","displayName":"email","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"cliente_intencao","displayName":"cliente_intencao","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"imovel_pretendido","displayName":"imovel_pretendido","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"nivel_interesse","displayName":"nivel_interesse","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"localizacao_preferida","displayName":"localizacao_preferida","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"retornar_em","displayName":"retornar_em","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[920,-180],"id":"9d78960e-cc1d-4f9e-bc9d-417f9a786d60","name":"Execute Workflow"},{"parameters":{"assignments":{"assignments":[{"id":"d23b1bc7-3ed9-4d80-8740-674c94821a70","name":"chatInput","value":"={{ $('When chat message received').item.json.chatInput }}","type":"string"},{"id":"1db63104-e993-4697-8b98-627ca5dc2f3b","name":"sessionId","value":"={{ $('When chat message received').item.json.sessionId }}","type":"string"},{"id":"105543ff-22e2-4321-819b-0f3cf3256f41","name":"name","value":"={{ \"Jo√£o da Silva\" }}","type":"string"},{"id":"f2a36f46-def6-42b9-99d1-291f225c6cc2","name":"phone","value":"5586981612934","type":"string"},{"id":"7500ff78-e186-4f63-a206-f2457d6615ac","name":"name_banco_dados","value":"={{ $json.response.name }}","type":"string"},{"id":"ec168587-6102-4f50-9169-0a3a8cfb69a9","name":"cliente_intencao","value":"={{ $json.response.cliente_intencao }}","type":"string"},{"id":"8312f8d4-41eb-4f84-81a3-7515a181adb4","name":"localizacao_preferida","value":"={{ $json.response.localizacao_preferida }}","type":"string"},{"id":"8dd06fc0-89cf-48fb-98bb-052298c2dd62","name":"imovel_pretendido","value":"={{ $json.response.imovel_pretendido }}","type":"string"}]},"includeOtherFields":"={{ false }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1220,-180],"id":"871523ca-9dbe-447e-8200-4144c1ca0eec","name":"config"},{"parameters":{"assignments":{"assignments":[{"id":"d23b1bc7-3ed9-4d80-8740-674c94821a70","name":"text","value":"={{ $('When chat message received').item.json.chatInput }}","type":"string"},{"id":"1db63104-e993-4697-8b98-627ca5dc2f3b","name":"sessionId","value":"={{ $('When chat message received').item.json.sessionId }}","type":"string"},{"id":"105543ff-22e2-4321-819b-0f3cf3256f41","name":"name","value":"={{ \"Jo√£o da Silva\" }}","type":"string"},{"id":"f2a36f46-def6-42b9-99d1-291f225c6cc2","name":"phone","value":"5586981612934","type":"string"}]},"includeOtherFields":"={{ false }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[660,-180],"id":"fa81f0e4-0404-4f64-a534-b635d8f412a6","name":"SetFieldsBasic"},{"parameters":{"content":"\n# Console-sdr-ImobiliariasMCP-export\n## Esta fun√ß√£o atualiza os dados do cliente, busca o cliente e encontra do CEP do endere√ßo do cliente.\n\n# Config:\n## Colouqe s URL do seu Strapi\n\n# Subfluxo\n## Selecione novamente o nome do subfluxo em 'Execute Worflow'\n\n# MCP Cliente\n## Coloque a URL do MCP Server\n\n# Config\n## Utilize o N√ì 'config' para configurar as URLS e tabelas do STRAPI onde os dados ser√£o armazenados\n\n# Comunidade\n## Participe para resolver problemas e tirar d√∫vidas:\n## https://comunidade.aalencar.com.br","height":1140,"width":900},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-540,-260],"id":"62461b93-1f94-47df-a8ff-f04903cd1f09","name":"Sticky Note"}],"connections":{"When chat message received":{"main":[[{"node":"SetFieldsBasic","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"MCP Client":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Execute Workflow":{"main":[[{"node":"config","type":"main","index":0}]]},"config":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"SetFieldsBasic":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c686625b-e022-41ef-a944-31dbf8977ff4","triggerCount":1,"shared":[{"updatedAt":"2025-07-12T19:42:56.451Z","createdAt":"2025-07-12T19:42:56.451Z","role":"workflow:owner","workflowId":"ut9wKawHdeV6gpN6","projectId":"BlSED80HESP48veq"}],"tags":[]}