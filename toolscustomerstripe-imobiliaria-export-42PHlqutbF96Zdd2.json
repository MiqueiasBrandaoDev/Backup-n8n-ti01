{"updatedAt":"2025-07-14T14:11:08.471Z","createdAt":"2025-07-12T19:47:22.919Z","id":"42PHlqutbF96Zdd2","name":"ToolsCustomerStripe-Imobiliaria-export","active":true,"isArchived":true,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"leftValue":"={{ $('Config').item.json.function }}","rightValue":"get_or_create","operator":{"type":"string","operation":"equals"},"id":"2ba71c7e-932a-48d6-9e98-fe922c9122af"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"61ad9fb3-58ca-48f7-9cf0-d52c39400446","leftValue":"={{ $('Config').item.json.function }}","rightValue":"update","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"40cbf966-b03f-4376-9af5-60733c67af73","leftValue":"={{ $('Config').item.json.function }}","rightValue":"find_cep","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2060,60],"id":"2e3612b6-80d0-4c15-874a-37404c2cea85","name":"Switch","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a011e5f-4fa4-4788-a027-4e8a5e3ec3ef","leftValue":"={{ $('FindLead').first().json?.id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2940,60],"id":"c1be9bfa-92c1-405f-bdd2-42c91ae9e08d","name":"If"},{"parameters":{"jsCode":"return { \n'response': $input.last().json\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4380,560],"id":"238705a7-ee6e-476c-bba1-674dc8a6f345","name":"Code"},{"parameters":{"numberInputs":6},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[4400,60],"id":"2f4f8dfc-bde0-4cb7-8c79-cf076d3c86f5","name":"Merge"},{"parameters":{"jsCode":"// Loop through input items\nconst output = $input.all().map(item => {\n  // Objeto 1 e Objeto 2\n\n  const object1 = $(\"FindLead\").first().json; // Primeiro objeto \n  const object2 = $(\"Config\").first().json // Segundo objeto\n  // Validar que os objetos existem\n  if (!object1 || !object2) {\n    throw new Error('Os campos \"object1\" e \"object2\" são obrigatórios nos dados de entrada.');\n  }\n\n  // Misturar os objetos, sobrepondo os valores do segundo objeto, caso não estejam em branco\n  const mergedObject = { ...object1 }; // Começa com os valores do objeto 1\n\n  for (const [key, value] of Object.entries(object2)) {\n    // Sobrescreve o valor apenas se não estiver vazio\n    if (value !== null && value !== undefined && value !== '') {\n      mergedObject[key] = value;\n    }\n  }\n\n  // Retornar o novo objeto combinado\n  return { json: { mergedObject } };\n});\n\nreturn output;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2640,420],"id":"cdd164c8-3542-4d02-ad14-d123362d8320","name":"MergeData"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1dbcca50-6942-4456-92b2-9175d0416950","leftValue":"={{ $('FindLead').last().json.isEmpty() }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2120,500],"id":"65e4d5e9-91be-43e5-9c9f-7ed43471ef7f","name":"If1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[2640,60],"id":"4bf3f82f-bf30-47e1-96de-720e92e83f0f","name":"Merge1"},{"parameters":{"url":"=https://viacep.com.br/ws/{{ $('Config').item.json.zip_code }}/json","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2080,860],"id":"ca6afd2f-9864-416d-bc2e-8245a59213b3","name":"ConsultaCep","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"jsCode":"return { \n'response': $input.last().json\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4380,840],"id":"3bda7178-c0d9-4f54-9569-5b4c25e9a3be","name":"Code1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d85ea53c-6018-4697-afc9-57f0c87f2750","leftValue":"={{ $json.cep }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3020,860],"id":"e2122f49-23a7-42d4-b05b-d73a338ce3dd","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"a4373703-63d9-433c-baff-3911c4ee98ba","name":"message","value":"CEP não localizado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,840],"id":"a71b3539-a881-4e7d-a0ed-02de0ce62669","name":"SetMessageZipCode2"},{"parameters":{"workflowInputs":{"values":[{"name":"function"},{"name":"phone"},{"name":"name"},{"name":"email"},{"name":"cliente_intencao"},{"name":"imovel_pretendido"},{"name":"nivel_interesse"},{"name":"localizacao_preferida"},{"name":"retornar_em"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[1040,60],"id":"d65d7009-c2a6-4c9d-85d0-72083ef4f472","name":"Start"},{"parameters":{"url":"={{ $json.url_strapi }}/{{ $json.table_name }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"phone","value":"={{ $json.phone }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1660,60],"id":"1b1f3433-4b74-45d2-ac5b-d32095942050","name":"FindLead","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"={{ $('Config').item.json.url_strapi }}/{{ $('Config').item.json.table_name }}","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"name\":\"{{ $('Start').item.json.name }}\",\n\"phone\":\"{{ $('Start').item.json.phone }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3680,140],"id":"fb18f59c-0748-4b32-80aa-92619e0fdb7d","name":"CreateLead","alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"332b1821-9580-4cfd-a520-1f8189e9d764","name":"function","value":"={{ $json.function || 'get_or_create' }}","type":"string"},{"id":"2e31c66f-31b8-4800-9154-e5365bcbfdec","name":"phone","value":"={{ $json.phone }}","type":"string"},{"id":"a7de30b6-1398-4812-a589-68eb0aa9d604","name":"name","value":"={{ $json.name }}","type":"string"},{"id":"bed1554c-d83b-4a11-b9aa-e59e2a63cbb9","name":"email","value":"={{ $json.email }}","type":"string"},{"id":"d788157d-9395-4ac8-9afc-16143362eca1","name":"localizacao_preferida","value":"={{ $json.localizacao_preferida }}","type":"string"},{"id":"db1e6593-d6dc-4820-984c-08583817ddb6","name":"cliente_intencao","value":"={{ $json.cliente_intencao }}","type":"string"},{"id":"8504cfca-3ab2-4720-bf79-74fc03df4d18","name":"retornar_em","value":"={{ $json.retornar_em || $now.plus(30,'days').toUTC() }}","type":"string"},{"id":"bd28d043-01ad-45b1-80ef-686610b8dec1","name":"imovel_pretendido","value":"={{ $json.imovel_pretendido || \"\" }}","type":"string"},{"id":"f1f44334-1c4a-4ede-87ad-1950126c65b6","name":"nivel_interesse","value":"={{ $json.nivel_interesse || \"baixo\" }}","type":"string"},{"id":"96f589b9-9d9f-4b8a-9e46-aed3a771f728","name":"table_name","value":"=leads","type":"string"},{"id":"7ff00a13-53cc-42d7-9ab4-2970d9a38463","name":"app","value":"imobiliaria","type":"string"},{"id":"7a702f86-8b3c-4825-a733-8de25b275a42","name":"url_strapi","value":"https://evolutionapi-strapi.ac69mn.easypanel.host","type":"string"}]},"includeOtherFields":"={{ false }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1340,60],"id":"bb7998fb-bbe9-4655-9171-bcede5068323","name":"Config","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"a6a8c8e4-dd0b-419f-ba52-979289a79c7a","name":"error","value":"={{ $json.error }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,400],"id":"72762bc9-bd0f-409a-addf-c2630e0ee70d","name":"SetError"},{"parameters":{"method":"PUT","url":"={{ $('Config').item.json.url_strapi }}/{{ $('Config').item.json.table_name }}/{{ $json.mergedObject.id }}","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"name\":\"{{ $json.mergedObject.name }}\",\n\"phone\":\"{{ $('Start').item.json.phone }}\",\n\"cliente_intencao\":\"{{ $json.mergedObject.cliente_intencao }}\",\n\"imovel_pretendido\":\"{{ $json.mergedObject.imovel_pretendido }}\",\n\"localizacao_preferida\":\"{{ $json.mergedObject.localizacao_preferida }}\",\n\"email\":\"{{ $json.mergedObject.email }}\",\n\"nivel_interesse\":\"{{ $json.mergedObject.nivel_interesse }}\",\n\"retornar_em\":\"{{ $json.mergedObject.retornar_em }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2980,420],"id":"a78e850d-ee2f-4cb9-88d7-a73fb70d072d","name":"UpdateCustomer","alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"cd4a20b6-7405-4eef-9ea1-e5680006b10d","name":"error","value":"={{ $json.error }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,620],"id":"2ed82b8b-2a03-4afb-aa2e-7266c13eae08","name":"setError"},{"parameters":{"content":"\n# ToolsCustomerStripe-Imobiliarias\n## Esta função atualiza os dados do cliente, busca o cliente e encontra do CEP do endereço do cliente.\n\n# Variável FUNCTION:\n## De acordo com o valor desta variável o fluxo realiza funções diferente: UPDATE, GE_OR_CREATE,FIND_CEP\n\n# Nomes do Fluxos\n## Renomeie todos o fluxos para o nomes sugeridos para não se perder\n\n# Config\n## Utilize o NÓ 'config' para configurar as URLS e tabelas do STRAPI onde os dados serão armazenados\n\n# Comunidade\n## Participe para resolver problemas e tirar dúvidas:\n## https://comunidade.aalencar.com.br","height":1140,"width":900},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"573ff5c4-0e76-460a-ab31-88758079aa92","name":"Sticky Note"}],"connections":{"Switch":{"main":[[{"node":"Merge1","type":"main","index":0}],[{"node":"If1","type":"main","index":0}],[{"node":"ConsultaCep","type":"main","index":0}]]},"If":{"main":[[{"node":"Merge","type":"main","index":0}],[{"node":"CreateLead","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Code","type":"main","index":0}]]},"MergeData":{"main":[[{"node":"UpdateCustomer","type":"main","index":0}]]},"If1":{"main":[[{"node":"Merge1","type":"main","index":1}],[{"node":"MergeData","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"If","type":"main","index":0}]]},"ConsultaCep":{"main":[[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Merge","type":"main","index":5}],[{"node":"SetMessageZipCode2","type":"main","index":0}]]},"SetMessageZipCode2":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Start":{"main":[[{"node":"Config","type":"main","index":0}]]},"FindLead":{"main":[[{"node":"Switch","type":"main","index":0}]]},"CreateLead":{"main":[[{"node":"Merge","type":"main","index":1}],[{"node":"SetError","type":"main","index":0}]]},"Config":{"main":[[{"node":"FindLead","type":"main","index":0}]]},"SetError":{"main":[[{"node":"Merge","type":"main","index":2}]]},"UpdateCustomer":{"main":[[{"node":"Merge","type":"main","index":3}],[{"node":"setError","type":"main","index":0}]]},"setError":{"main":[[{"node":"Merge","type":"main","index":4}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"581d69f9-d64d-4db5-b280-03f87a3a11e1","activeVersionId":"581d69f9-d64d-4db5-b280-03f87a3a11e1","triggerCount":0,"shared":[{"updatedAt":"2025-07-12T19:47:22.919Z","createdAt":"2025-07-12T19:47:22.919Z","role":"workflow:owner","workflowId":"42PHlqutbF96Zdd2","projectId":"BlSED80HESP48veq"}],"activeVersion":{"updatedAt":"2025-12-01T11:56:54.083Z","createdAt":"2025-12-01T11:56:54.083Z","versionId":"581d69f9-d64d-4db5-b280-03f87a3a11e1","workflowId":"42PHlqutbF96Zdd2","nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"leftValue":"={{ $('Config').item.json.function }}","rightValue":"get_or_create","operator":{"type":"string","operation":"equals"},"id":"2ba71c7e-932a-48d6-9e98-fe922c9122af"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"61ad9fb3-58ca-48f7-9cf0-d52c39400446","leftValue":"={{ $('Config').item.json.function }}","rightValue":"update","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"40cbf966-b03f-4376-9af5-60733c67af73","leftValue":"={{ $('Config').item.json.function }}","rightValue":"find_cep","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2060,60],"id":"2e3612b6-80d0-4c15-874a-37404c2cea85","name":"Switch","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8a011e5f-4fa4-4788-a027-4e8a5e3ec3ef","leftValue":"={{ $('FindLead').first().json?.id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2940,60],"id":"c1be9bfa-92c1-405f-bdd2-42c91ae9e08d","name":"If"},{"parameters":{"jsCode":"return { \n'response': $input.last().json\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4380,560],"id":"238705a7-ee6e-476c-bba1-674dc8a6f345","name":"Code"},{"parameters":{"numberInputs":6},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[4400,60],"id":"2f4f8dfc-bde0-4cb7-8c79-cf076d3c86f5","name":"Merge"},{"parameters":{"jsCode":"// Loop through input items\nconst output = $input.all().map(item => {\n  // Objeto 1 e Objeto 2\n\n  const object1 = $(\"FindLead\").first().json; // Primeiro objeto \n  const object2 = $(\"Config\").first().json // Segundo objeto\n  // Validar que os objetos existem\n  if (!object1 || !object2) {\n    throw new Error('Os campos \"object1\" e \"object2\" são obrigatórios nos dados de entrada.');\n  }\n\n  // Misturar os objetos, sobrepondo os valores do segundo objeto, caso não estejam em branco\n  const mergedObject = { ...object1 }; // Começa com os valores do objeto 1\n\n  for (const [key, value] of Object.entries(object2)) {\n    // Sobrescreve o valor apenas se não estiver vazio\n    if (value !== null && value !== undefined && value !== '') {\n      mergedObject[key] = value;\n    }\n  }\n\n  // Retornar o novo objeto combinado\n  return { json: { mergedObject } };\n});\n\nreturn output;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2640,420],"id":"cdd164c8-3542-4d02-ad14-d123362d8320","name":"MergeData"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1dbcca50-6942-4456-92b2-9175d0416950","leftValue":"={{ $('FindLead').last().json.isEmpty() }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2120,500],"id":"65e4d5e9-91be-43e5-9c9f-7ed43471ef7f","name":"If1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[2640,60],"id":"4bf3f82f-bf30-47e1-96de-720e92e83f0f","name":"Merge1"},{"parameters":{"url":"=https://viacep.com.br/ws/{{ $('Config').item.json.zip_code }}/json","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2080,860],"id":"ca6afd2f-9864-416d-bc2e-8245a59213b3","name":"ConsultaCep","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"jsCode":"return { \n'response': $input.last().json\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4380,840],"id":"3bda7178-c0d9-4f54-9569-5b4c25e9a3be","name":"Code1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d85ea53c-6018-4697-afc9-57f0c87f2750","leftValue":"={{ $json.cep }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3020,860],"id":"e2122f49-23a7-42d4-b05b-d73a338ce3dd","name":"If3"},{"parameters":{"assignments":{"assignments":[{"id":"a4373703-63d9-433c-baff-3911c4ee98ba","name":"message","value":"CEP não localizado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,840],"id":"a71b3539-a881-4e7d-a0ed-02de0ce62669","name":"SetMessageZipCode2"},{"parameters":{"workflowInputs":{"values":[{"name":"function"},{"name":"phone"},{"name":"name"},{"name":"email"},{"name":"cliente_intencao"},{"name":"imovel_pretendido"},{"name":"nivel_interesse"},{"name":"localizacao_preferida"},{"name":"retornar_em"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[1040,60],"id":"d65d7009-c2a6-4c9d-85d0-72083ef4f472","name":"Start"},{"parameters":{"url":"={{ $json.url_strapi }}/{{ $json.table_name }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"phone","value":"={{ $json.phone }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1660,60],"id":"1b1f3433-4b74-45d2-ac5b-d32095942050","name":"FindLead","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"method":"POST","url":"={{ $('Config').item.json.url_strapi }}/{{ $('Config').item.json.table_name }}","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"name\":\"{{ $('Start').item.json.name }}\",\n\"phone\":\"{{ $('Start').item.json.phone }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3680,140],"id":"fb18f59c-0748-4b32-80aa-92619e0fdb7d","name":"CreateLead","alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"332b1821-9580-4cfd-a520-1f8189e9d764","name":"function","value":"={{ $json.function || 'get_or_create' }}","type":"string"},{"id":"2e31c66f-31b8-4800-9154-e5365bcbfdec","name":"phone","value":"={{ $json.phone }}","type":"string"},{"id":"a7de30b6-1398-4812-a589-68eb0aa9d604","name":"name","value":"={{ $json.name }}","type":"string"},{"id":"bed1554c-d83b-4a11-b9aa-e59e2a63cbb9","name":"email","value":"={{ $json.email }}","type":"string"},{"id":"d788157d-9395-4ac8-9afc-16143362eca1","name":"localizacao_preferida","value":"={{ $json.localizacao_preferida }}","type":"string"},{"id":"db1e6593-d6dc-4820-984c-08583817ddb6","name":"cliente_intencao","value":"={{ $json.cliente_intencao }}","type":"string"},{"id":"8504cfca-3ab2-4720-bf79-74fc03df4d18","name":"retornar_em","value":"={{ $json.retornar_em || $now.plus(30,'days').toUTC() }}","type":"string"},{"id":"bd28d043-01ad-45b1-80ef-686610b8dec1","name":"imovel_pretendido","value":"={{ $json.imovel_pretendido || \"\" }}","type":"string"},{"id":"f1f44334-1c4a-4ede-87ad-1950126c65b6","name":"nivel_interesse","value":"={{ $json.nivel_interesse || \"baixo\" }}","type":"string"},{"id":"96f589b9-9d9f-4b8a-9e46-aed3a771f728","name":"table_name","value":"=leads","type":"string"},{"id":"7ff00a13-53cc-42d7-9ab4-2970d9a38463","name":"app","value":"imobiliaria","type":"string"},{"id":"7a702f86-8b3c-4825-a733-8de25b275a42","name":"url_strapi","value":"https://evolutionapi-strapi.ac69mn.easypanel.host","type":"string"}]},"includeOtherFields":"={{ false }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1340,60],"id":"bb7998fb-bbe9-4655-9171-bcede5068323","name":"Config","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"a6a8c8e4-dd0b-419f-ba52-979289a79c7a","name":"error","value":"={{ $json.error }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,400],"id":"72762bc9-bd0f-409a-addf-c2630e0ee70d","name":"SetError"},{"parameters":{"method":"PUT","url":"={{ $('Config').item.json.url_strapi }}/{{ $('Config').item.json.table_name }}/{{ $json.mergedObject.id }}","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"name\":\"{{ $json.mergedObject.name }}\",\n\"phone\":\"{{ $('Start').item.json.phone }}\",\n\"cliente_intencao\":\"{{ $json.mergedObject.cliente_intencao }}\",\n\"imovel_pretendido\":\"{{ $json.mergedObject.imovel_pretendido }}\",\n\"localizacao_preferida\":\"{{ $json.mergedObject.localizacao_preferida }}\",\n\"email\":\"{{ $json.mergedObject.email }}\",\n\"nivel_interesse\":\"{{ $json.mergedObject.nivel_interesse }}\",\n\"retornar_em\":\"{{ $json.mergedObject.retornar_em }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2980,420],"id":"a78e850d-ee2f-4cb9-88d7-a73fb70d072d","name":"UpdateCustomer","alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"cd4a20b6-7405-4eef-9ea1-e5680006b10d","name":"error","value":"={{ $json.error }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3700,620],"id":"2ed82b8b-2a03-4afb-aa2e-7266c13eae08","name":"setError"},{"parameters":{"content":"\n# ToolsCustomerStripe-Imobiliarias\n## Esta função atualiza os dados do cliente, busca o cliente e encontra do CEP do endereço do cliente.\n\n# Variável FUNCTION:\n## De acordo com o valor desta variável o fluxo realiza funções diferente: UPDATE, GE_OR_CREATE,FIND_CEP\n\n# Nomes do Fluxos\n## Renomeie todos o fluxos para o nomes sugeridos para não se perder\n\n# Config\n## Utilize o NÓ 'config' para configurar as URLS e tabelas do STRAPI onde os dados serão armazenados\n\n# Comunidade\n## Participe para resolver problemas e tirar dúvidas:\n## https://comunidade.aalencar.com.br","height":1140,"width":900},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"573ff5c4-0e76-460a-ab31-88758079aa92","name":"Sticky Note"}],"connections":{"Switch":{"main":[[{"node":"Merge1","type":"main","index":0}],[{"node":"If1","type":"main","index":0}],[{"node":"ConsultaCep","type":"main","index":0}]]},"If":{"main":[[{"node":"Merge","type":"main","index":0}],[{"node":"CreateLead","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Code","type":"main","index":0}]]},"MergeData":{"main":[[{"node":"UpdateCustomer","type":"main","index":0}]]},"If1":{"main":[[{"node":"Merge1","type":"main","index":1}],[{"node":"MergeData","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"If","type":"main","index":0}]]},"ConsultaCep":{"main":[[{"node":"If3","type":"main","index":0}]]},"If3":{"main":[[{"node":"Merge","type":"main","index":5}],[{"node":"SetMessageZipCode2","type":"main","index":0}]]},"SetMessageZipCode2":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Start":{"main":[[{"node":"Config","type":"main","index":0}]]},"FindLead":{"main":[[{"node":"Switch","type":"main","index":0}]]},"CreateLead":{"main":[[{"node":"Merge","type":"main","index":1}],[{"node":"SetError","type":"main","index":0}]]},"Config":{"main":[[{"node":"FindLead","type":"main","index":0}]]},"SetError":{"main":[[{"node":"Merge","type":"main","index":2}]]},"UpdateCustomer":{"main":[[{"node":"Merge","type":"main","index":3}],[{"node":"setError","type":"main","index":0}]]},"setError":{"main":[[{"node":"Merge","type":"main","index":4}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}