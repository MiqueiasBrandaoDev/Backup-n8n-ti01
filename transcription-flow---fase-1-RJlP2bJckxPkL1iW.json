{"updatedAt":"2025-12-31T21:54:46.575Z","createdAt":"2025-12-31T13:57:46.668Z","id":"RJlP2bJckxPkL1iW","name":"Transcription Flow - Fase 1","active":false,"isArchived":false,"nodes":[{"parameters":{"command":"={{ \nconst src = $('01. Watch Folder1').first()?.json?.path || '';\nconst watchFolder = $env.WATCH_FOLDER || '/data/input';\nconst processedFolder = watchFolder.replace(/\\/Watch Folder$|\\/input$/, '') + '/Processed';\nconst fileName = src.split('/').pop().split('\\\\\\\\').pop();\n'mkdir -p \"' + processedFolder + '\" && mv \"' + src + '\" \"' + processedFolder + '/' + fileName + '\"'\n}}"},"id":"7cade2f4-a61b-44c3-8765-1e02d0e7cc55","name":"01d. Mover Duplicado","type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[2288,2240],"notes":"Move arquivo duplicado para Processed SEM processar.\nNao gasta tokens de API.\nProtege usuario desavisado."},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".mp3"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".wav"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".m4a"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".ogg"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".flac"}]},"options":{}},"id":"4e48683c-3206-42ec-b532-0a18c4052489","name":"02a. E Audio?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[2352,1744],"notes":"Verifica se o arquivo e audio (mp3, wav, m4a, ogg, flac)"},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".mp4"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".mkv"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".avi"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".mov"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".webm"}]},"options":{}},"id":"33bf9ba5-5f50-4b03-b7d1-2e55908c3663","name":"02b. E Video?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[2816,1776],"notes":"Verifica se o arquivo e video (mp4, mkv, avi, mov, webm)"},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".pdf"}]},"options":{}},"id":"9d908286-a715-40d8-9891-b74bae48df72","name":"02c. E PDF?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[3104,1792],"notes":"Verifica se o arquivo e PDF"},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".jpg"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".jpeg"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".png"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".gif"},{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".webp"}]},"options":{}},"id":"3144f2ef-2ac2-49d3-b923-2adf3a036234","name":"02d. E Imagem?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[3200,2192],"notes":"Verifica se o arquivo e imagem (jpg, png, gif, webp)"},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.path.toLowerCase() }}","operation":"endsWith","value2":".txt"}]},"options":{}},"id":"42cf6135-1111-49f6-bdb0-a15d9be6b940","name":"02e. E Link YouTube?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[3312,2480],"notes":"Verifica se e um arquivo .txt contendo link do YouTube.\nO arquivo .txt deve conter apenas a URL do video."},{"parameters":{"command":"={{ 'ffmpeg -i \"' + $json.path + '\" -vn -acodec libmp3lame -q:a 2 \"' + $json.path.replace(/\\.[^/.]+$/, '') + '_audio.mp3\" -y' }}"},"id":"7c60a9a2-221f-4405-ad80-4819085b07fc","name":"03. Extrair Audio do Video1","type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[3072,1472],"notes":"PREREQUISITO: FFmpeg instalado no servidor\n\nComando:\nffmpeg -i [video] -vn -acodec libmp3lame -q:a 2 [audio.mp3]\n\n-vn: sem video\n-acodec libmp3lame: codec MP3\n-q:a 2: qualidade alta"},{"parameters":{"options":{}},"id":"537cc4d4-43f1-4cdd-ab7f-6fdc00f94f6a","name":"04. Preparar Caminho Audio1","type":"n8n-nodes-base.set","typeVersion":3,"position":[3856,1456],"notes":"Define variaveis:\n- audioPath: caminho do arquivo de audio\n- originalPath: caminho original\n- fileName: nome do arquivo sem extensao"},{"parameters":{"method":"POST","url":"=https://faster-whisper-server-production.up.railway.app/v1/audio/transcriptions","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"},{"name":"response_format","value":"verbose_json"},{"name":"language"}]},"options":{"timeout":600000}},"id":"4288b107-d84c-422d-8ba2-7cb72f4b5e47","name":"05. Transcrever com Whisper1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[4320,1456],"notes":"CONFIGURACAO:\n1. url: Endereco do Whisper Server\n   - Se docker-compose: http://whisper-server:8000\n   - Se externo: http://SEU_IP:8000\n\n2. file: Arquivo de audio (automatico)\n\n3. response_format: verbose_json\n   Retorna transcricao com timestamps\n\n4. language: Deixe vazio para auto-detectar\n   Ou use: pt, en, es, etc.\n\n5. timeout: 600000ms (10 min) para audios longos\n\nOUTPUT:\n- text: transcricao completa\n- segments: trechos com timestamps"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"data:application/pdf;base64,\" + $binary.data.data\n  }\n}) }}","options":{"timeout":120000}},"id":"0620cc3f-3be4-4a38-bd7f-2bd8cb5678fe","name":"06a. OCR PDF (Mistral)1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[3584,1776],"credentials":{"httpHeaderAuth":{"id":"Q0u6OvUUnc9JRpBL","name":"Header Auth account"}},"notes":"CONFIGURACAO:\n1. Criar credencial HTTP Header Auth:\n   - Name: Authorization\n   - Value: Bearer SUA_MISTRAL_API_KEY\n\n2. Obter API Key em:\n   https://console.mistral.ai\n\nOUTPUT:\n- pages[].markdown: texto extraido em Markdown"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"image_url\",\n    \"image_url\": \"data:image/\" + $json.path.split('.').pop() + \";base64,\" + $binary.data.data\n  }\n}) }}","options":{"timeout":60000}},"id":"e6e41471-d601-4b10-9200-417bb7dda51e","name":"06b. OCR Imagem (Mistral)1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[4416,2176],"credentials":{"httpHeaderAuth":{"id":"Q0u6OvUUnc9JRpBL","name":"Header Auth account"}},"notes":"Mesma configuracao do no de PDF.\nUsa a mesma credencial Mistral."},{"parameters":{"command":"={{ 'yt-dlp -x --audio-format mp3 -o \"' + ($env.TEMP_FOLDER || '/tmp') + '/%(title)s.%(ext)s\" \"' + $json.data.toString().trim() + '\"' }}"},"id":"1014c030-ec05-4288-8339-501f2292dffd","name":"04e. Download YouTube1","type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[3776,2464],"notes":"PREREQUISITO: yt-dlp instalado no servidor\n\nInstalar:\npip install yt-dlp\n\nComando:\nyt-dlp -x --audio-format mp3 -o [output] [url]\n\n-x: extrair apenas audio\n--audio-format mp3: converter para MP3"},{"parameters":{"method":"POST","url":"https://api-free.deepl.com/v2/translate","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({\n  \"text\": [$json.text || $json.content],\n  \"target_lang\": \"PT-BR\"\n}) }}","options":{"timeout":60000}},"id":"3aebbf7a-6ec3-4dea-aa9d-c6b857ce4f8f","name":"07. Traduzir (DeepL)1","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[4592,1776],"credentials":{"httpHeaderAuth":{"id":"EobRfwEtwl86IQ4C","name":"Header Auth account 2"}},"notes":"CONFIGURACAO:\n1. Criar credencial HTTP Header Auth:\n   - Name: Authorization\n   - Value: DeepL-Auth-Key SUA_DEEPL_API_KEY\n\n2. Obter API Key em:\n   https://www.deepl.com/pro-api\n   (versao gratuita: 500k chars/mes)\n\n3. URL:\n   - Free: https://api-free.deepl.com/v2/translate\n   - Pro: https://api.deepl.com/v2/translate\n\n4. target_lang: PT-BR (portugues brasileiro)\n\nOUTPUT:\n- translations[0].text: texto traduzido"},{"parameters":{"options":{}},"id":"113a00e5-9f92-4abe-afff-85bfe36d4b27","name":"08. Preparar Output1","type":"n8n-nodes-base.set","typeVersion":3,"position":[4832,1776],"notes":"Prepara os dados para gerar o arquivo Markdown:\n- originalText: texto original (transcricao ou OCR)\n- translatedText: texto traduzido\n- fileName: nome do arquivo de saida"},{"parameters":{"options":{}},"id":"893fa23b-f89f-4eb8-86a6-c6d93828d9bb","name":"09. Gerar Markdown1","type":"n8n-nodes-base.set","typeVersion":3,"position":[5040,1776],"notes":"Gera o conteudo do arquivo Markdown com:\n- Titulo\n- Metadados (data, fonte)\n- Conteudo traduzido\n- Conteudo original"},{"parameters":{"options":{}},"id":"5b3c2f52-2f20-42dd-9d1d-e17679acf249","name":"06. Merge Transcricao1","type":"n8n-nodes-base.set","typeVersion":3,"position":[4480,1456],"notes":"Prepara dados da transcricao para traducao"},{"parameters":{"options":{}},"id":"b6d4c618-190c-4590-9ce9-d2511a2268fa","name":"06c. Merge OCR1","type":"n8n-nodes-base.set","typeVersion":3,"position":[4016,1776],"notes":"Combina o resultado do OCR em um texto unico"},{"parameters":{},"id":"05cac9ee-08c0-4c02-9ea0-6a42a62f5d9d","name":"Em Caso de Erro1","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[4992,2112],"notes":"No de fallback para tratamento de erros.\nConecte a saida de erro dos nos criticos aqui."},{"parameters":{"rule":{"interval":[{"field":"minutes"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[1664,1744],"id":"f33b4caa-0855-4fcb-9de9-fa865495ffb3","name":"Schedule Trigger"},{"parameters":{"authentication":"oAuth2","resource":"folder","operation":"list","path":"/Orquestrador/Projetos de SaaS/Transcription Flow/Watch Folder","filters":{}},"type":"n8n-nodes-base.dropbox","typeVersion":1,"position":[1872,1744],"id":"a1acc905-589c-4130-bc11-d74fe900e102","name":"List a folder","credentials":{"dropboxOAuth2Api":{"id":"mxskudV3xduy9W7h","name":"Dropbox account"}}},{"parameters":{"authentication":"oAuth2","operation":"download","path":"={{ $json.id }}"},"type":"n8n-nodes-base.dropbox","typeVersion":1,"position":[2080,1744],"id":"43c382d0-10df-489a-a35a-04d987e401d0","name":"Download a file","credentials":{"dropboxOAuth2Api":{"id":"mxskudV3xduy9W7h","name":"Dropbox account"}}},{"parameters":{"authentication":"oAuth2","path":"=/Orquestrador/Projetos de SaaS/Transcription Flow/Output/{{ $json.fileName }}.md"},"type":"n8n-nodes-base.dropbox","typeVersion":1,"position":[5248,1776],"id":"9d441861-71dc-4ab1-ab63-cd1594de8388","name":"Salvar no Dropbox","credentials":{"dropboxOAuth2Api":{"id":"mxskudV3xduy9W7h","name":"Dropbox account"}}}],"connections":{"02a. E Audio?1":{"main":[[{"node":"04. Preparar Caminho Audio1","type":"main","index":0}],[{"node":"02b. E Video?1","type":"main","index":0}]]},"02b. E Video?1":{"main":[[{"node":"03. Extrair Audio do Video1","type":"main","index":0}],[{"node":"02c. E PDF?1","type":"main","index":0}]]},"02c. E PDF?1":{"main":[[{"node":"06a. OCR PDF (Mistral)1","type":"main","index":0}],[{"node":"02d. E Imagem?1","type":"main","index":0}]]},"02d. E Imagem?1":{"main":[[{"node":"06b. OCR Imagem (Mistral)1","type":"main","index":0}],[{"node":"02e. E Link YouTube?1","type":"main","index":0}]]},"02e. E Link YouTube?1":{"main":[[{"node":"04e. Download YouTube1","type":"main","index":0}]]},"03. Extrair Audio do Video1":{"main":[[{"node":"04. Preparar Caminho Audio1","type":"main","index":0}]]},"04. Preparar Caminho Audio1":{"main":[[{"node":"05. Transcrever com Whisper1","type":"main","index":0}]]},"05. Transcrever com Whisper1":{"main":[[{"node":"06. Merge Transcricao1","type":"main","index":0}]]},"06a. OCR PDF (Mistral)1":{"main":[[{"node":"06c. Merge OCR1","type":"main","index":0}]]},"06b. OCR Imagem (Mistral)1":{"main":[[{"node":"06c. Merge OCR1","type":"main","index":0}]]},"04e. Download YouTube1":{"main":[[{"node":"04. Preparar Caminho Audio1","type":"main","index":0}]]},"07. Traduzir (DeepL)1":{"main":[[{"node":"08. Preparar Output1","type":"main","index":0}]]},"08. Preparar Output1":{"main":[[{"node":"09. Gerar Markdown1","type":"main","index":0}]]},"09. Gerar Markdown1":{"main":[[{"node":"Salvar no Dropbox","type":"main","index":0}]]},"06. Merge Transcricao1":{"main":[[{"node":"07. Traduzir (DeepL)1","type":"main","index":0}]]},"06c. Merge OCR1":{"main":[[{"node":"07. Traduzir (DeepL)1","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"List a folder","type":"main","index":0}]]},"List a folder":{"main":[[{"node":"Download a file","type":"main","index":0}]]},"Download a file":{"main":[[{"node":"02a. E Audio?1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"ab89a0d5-be19-4c82-9a68-9b49fa81353c","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-31T13:57:46.668Z","createdAt":"2025-12-31T13:57:46.668Z","role":"workflow:owner","workflowId":"RJlP2bJckxPkL1iW","projectId":"9D0onndgPCA6zn0e"}],"activeVersion":null,"tags":[{"updatedAt":"2025-12-31T13:42:29.079Z","createdAt":"2025-12-31T13:42:29.079Z","id":"SyRtfXO6k1SeQE0s","name":"Transcription Flow"}]}