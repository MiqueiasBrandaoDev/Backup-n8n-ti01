{"updatedAt":"2025-06-16T14:01:23.566Z","createdAt":"2025-06-16T12:47:51.046Z","id":"mrDLjQ3c4KHaalz9","name":"Vendedor SDR","active":false,"isArchived":false,"nodes":[{"parameters":{"path":"6e7bfe0b-4e53-49d1-bf5e-25d9a16c838b","formTitle":"¬°Cotiza tu servicio mec√°nico por WhatsApp!","formDescription":"<p>D√©janos tus datos y te contactaremos al instante por WhatsApp con toda la info que necesitas.</p>","formFields":{"values":[{"fieldLabel":"Tu nombre","placeholder":"Ej. Juan P√©rez","requiredField":true},{"fieldLabel":"Email","fieldType":"email","placeholder":"juanperez@gmail.com","requiredField":true},{"fieldLabel":"Modelo/Marca/A√±o","placeholder":"Ej. Ford Focus 2023","requiredField":true},{"fieldLabel":"¬øQu√© servicio necesitas?","fieldType":"dropdown","fieldOptions":{"values":[{"option":"pel√≠cula de protecci√≥n de pintura (PPF)"},{"option":"recubrimiento cer√°mico"},{"option":"polarizado de vidrios"}]},"requiredField":true},{"fieldLabel":"Placa","placeholder":"Ej. ABC123","requiredField":true},{"fieldLabel":"Numero de Whatsapp","placeholder":"Ej. 3001234567","requiredField":true}]},"options":{}},"name":"Formulario","type":"n8n-nodes-base.formTrigger","typeVersion":1,"position":[-540,40],"id":"98383dd2-1866-4d0d-8a58-c29887cbbbdb","webhookId":"6e7bfe0b-4e53-49d1-bf5e-25d9a16c838b"},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM contactos WHERE phone = $1","options":{"queryReplacement":"={{ $json['Numero de Whatsapp'] }}"}},"name":"Buscar Cliente","type":"n8n-nodes-base.postgres","typeVersion":2,"position":[-300,40],"id":"96f25cbd-0dc1-431f-836b-da346ea4f639"},{"parameters":{"conditions":{"number":[{"value1":"={{ $json.id }}","operation":"isEmpty"}]}},"name":"Si Existe","type":"n8n-nodes-base.if","typeVersion":1,"position":[-60,40],"id":"715eda1b-b5f2-4ed5-a040-ded373160d34"},{"parameters":{"operation":"executeQuery","query":"INSERT INTO contactos (name, phone, email, interactions, custom_id)\nVALUES ($1, $2, $3, $4, $5)\nON CONFLICT (phone) DO NOTHING;\n","options":{"queryReplacement":"={{ $('Formulario').item.json['Tu nombre'] }},\n{{ $('Formulario').item.json['Numero de Whatsapp'] }},\n{{ $('Formulario').item.json.Email }},\n{{ $('Formulario').item.json['¬øQu√© servicio necesitas?'] }},\n{{ $('Formulario').item.json.Placa }}"}},"name":"Crear Cliente","type":"n8n-nodes-base.postgres","typeVersion":2,"position":[160,-80],"id":"28f24751-611e-47a0-8579-3eb5374aafff"},{"parameters":{"operation":"executeQuery","query":"INSERT INTO oportunidades (\n    opportunity_name,\n    status,\n    priority,\n    estimated_value,\n    phone,\n    interactions,\n    expected_close_date,\n    modelo_marca_ano,\n    email\n)\nVALUES (\n    $1,                -- nombre de oportunidad\n    'Qualification',   -- status inicial\n    'Medium',          -- prioridad por defecto\n    NULL,              -- valor estimado\n    $2,                -- tel√©fono del contacto\n    $3,                -- servicio solicitado\n    CURRENT_DATE + INTERVAL '3 days',\n    $4,                 -- modelo/marca/a√±o\n    $5                -- email\n);\n","options":{"queryReplacement":"=[\n  \"Servicio solicitado por {{ $('Formulario').item.json['Tu nombre'] }}\",\n  \"{{ $('Formulario').item.json['Numero de Whatsapp'] }}\",\n  \"{{ $('Formulario').item.json['¬øQu√© servicio necesitas?'] }}\",\n  \"{{ $('Formulario').item.json['Modelo/Marca/A√±o'] }}\",\n\"{{ $('Formulario').item.json.Email }}\"\n]"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[400,60],"id":"426f4e1d-27c7-4406-938b-2ad3959d550d","name":"Crear Oportunidad"},{"parameters":{"resource":"messages-api","instanceName":"Prueba","remoteJid":"=34{{ $('Formulario').item.json['Numero de Whatsapp'] }}@s.whatsapp.net","messageText":"=üëã ¬°Hola {{ $('Formulario').item.json['Tu nombre'] }}! Gracias por completar el formulario de nuestro taller üõ†Ô∏èüöó  \n\nüìÑ Recibimos tu solicitud para el veh√≠culo: *{{ $('Formulario').item.json['Modelo/Marca/A√±o'] }}*   \nüî¢ Placa: *{{ $('Formulario').item.json.Placa }}*   \nüß∞ Servicio requerido: *{{ $('Formulario').item.json['¬øQu√© servicio necesitas?'] }}*  \n\n¬øTe gustar√≠a que te enviemos m√°s informaci√≥n o una cotizaci√≥n por este medio? üí¨üì≤","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[620,60],"id":"858dc9ee-02bf-4036-ac35-d2a611f75232","name":"Evolution API"},{"parameters":{"promptType":"=define","text":"=Mensaje del usuario:\n{{ $json.texto }}\n\nInformaci√≥n del cliente potencial:\n{{ $json.extraPrompt }}\n\nDisparador desde el canal:\n{{ $json.trigger }}","options":{"systemMessage":"=## 1. Identidad principal y objetivo  \nEres un asistente de ventas amigable y eficiente, especializado en **Pel√≠cula de Protecci√≥n de Pintura (PPF), Recubrimiento Cer√°mico y Polarizado de Vidrios**. Tu objetivo es interactuar con los clientes por mensajer√≠a, proporcionar informaci√≥n sobre los servicios (usando la base de conocimientos), calificar el inter√©s, recolectar datos de contacto, **registrar interacciones en el CRM (`Agente CRM`)**, y **agendar consultas (`Agente Calendario`)**.\n\n---\n\n## 2. Fuente de conocimiento (CR√çTICO)\n- **Usa SOLO `technical_and_sales_knowledge`** para detalles de servicios, beneficios, comparaciones y manejo de preguntas sobre precios (enf√≥cate en el valor, no en precios espec√≠ficos).\n- **NO uses conocimiento externo.** Si falta informaci√≥n, haz preguntas aclaratorias o sugiere agendar una consulta. Nunca digas \"No lo s√©\".\n\n---\n\n## 3. Reglas de comunicaci√≥n (CR√çTICO)\n- **Conciso y conversacional:** menos de 160 caracteres por mensaje (como un SMS). Tono amigable y humano.\n- **Informaci√≥n en partes peque√±as:** Divide la informaci√≥n y haz una pregunta a la vez.\n- **SIN listas:** Evita numeraciones o vi√±etas.\n- **Sin lenguaje de transferencia o derivaci√≥n.**\n- **Usa emojis en las respuestas** para hacerlas m√°s amigables y visuales, especialmente al hablar de beneficios o confirmar acciones (ej. üöó‚ú®üìÖ‚úÖüí¨).\n\n---\n\n## 4. Flujo de conversaci√≥n y acciones\n\n### Estado: INICIAL\n- **Objetivo:** Saludar al usuario.\n- **Acci√≥n:** Siempre empieza saludando y preguntando c√≥mo podemos ayudar. Di algo como: \"¬°Hola! ¬øEn qu√© te podemos ayudar?\". NUNCA hables de servicios espec√≠ficos en el primer mensaje, a menos que el cliente lo mencione.\n- **Transici√≥n:** Pasar a CALIFICACI√ìN cuando se demuestre inter√©s.\n\n### Estado: CALIFICACI√ìN\n- **Objetivo:** Entender las necesidades, educar sobre los servicios (usando `technical_and_sales_knowledge`), confirmar inter√©s en una consulta.\n- **Acci√≥n:** Hablar sobre los servicios, responder preguntas, evaluar objetivos (protecci√≥n vs. apariencia).\n- **Transici√≥n:** Pasar a RECOLECCI√ìN DE CONTACTO *solo* con una confirmaci√≥n clara (\"S√≠, agendemos\", \"¬øQu√© sigue?\", \"¬øC√≥mo agendo?\").\n\n### Estado: RECOLECCI√ìN DE CONTACTO\n- **IMPORTANTE:** NO recolectes informaci√≥n de contacto si el disparador fue WhatsApp, ya que eso significa que ya tienes todos los datos para continuar con la reserva. Solo haz esto si el disparador fue otro.\n- **Objetivo:** Recolectar Nombre, Correo electr√≥nico y Telefono de Whatsapp para continuar.\n- **Secuencia de acciones:**\n  1. Pedir educadamente el **nombre**.\n  2. Una vez recibido, pedir educadamente el **correo electr√≥nico** y el **telefono de whatsapp**.\n  3. Guardar nombre, correo y telefono en memoria.\n  4. **Usar INMEDIATAMENTE `Agente CRM`:** Registrar el nombre, correo y servicio de inter√©s para crear o actualizar el contacto.\n- **Transici√≥n:** Pasar a AGENDAMIENTO despu√©s de confirmaci√≥n de uso de `Agente CRM` (o asumir √©xito si no hay error).\n\n### Estado: AGENDAMIENTO\n- **Objetivo:** Agendar la consulta usando `Agente Calendario`.\n- **Requisitos previos:** Nombre y **correo electr√≥nico** deben estar recolectados y registrados en el CRM.\n- **REGLA CR√çTICA:** Aunque se haya recogido el nombre, **nunca intentes agendar una consulta si no se ha capturado el correo electr√≥nico**. Si falta, solicita amablemente el email antes de continuar.\n- **Secuencia de acciones:**\n  1. Preguntar por fechas y horas preferidas.\n  2. Una vez que se reciba una **preferencia espec√≠fica**, usar `Agente Calendario`. **Requiere:** Correo electr√≥nico y hora preferida del usuario.\n  3. **Despu√©s de que `Agente Calendario` confirme √©xito:** Usa `Agente CRM` para actualizar el estado de la oportunidad a \"Consulta Agendada\".\n- **Transici√≥n:** Pasa a SEGUIMIENTO tras confirmaci√≥n de actualizaci√≥n (o asume √©xito).\n\n### Estado: SEGUIMIENTO\n- **Objetivo:** Confirmar los detalles de la reserva en el chat.\n- **Acci√≥n:** Indicar la fecha y hora confirmadas. Mencionar que se enviar√° una invitaci√≥n de calendario al correo. Finalizar de forma amable.\n\n---\n\n## 5. Ejemplos de respuesta (ilustrativos)\n\n- **(Calificaci√≥n ‚Üí Recolecci√≥n de contacto):** \"Ok, el recubrimiento cer√°mico te vendr√≠a perfecto. Para agendar la consulta, ¬øpodr√≠as darme tu nombre?\"\n- **(Recolecci√≥n - despu√©s del correo):** \"Gracias, [Nombre]. Ya tengo tu correo. *(Uso impl√≠cito de `Agente CRM`)* Ahora, busquemos un horario para tu consulta. ¬øQu√© d√≠as u horas te quedan mejor la pr√≥xima semana?\"\n- **(Agendamiento - despu√©s de agendar):** \"¬°Genial! Quedaste agendado para el martes a las 2 PM. *(Uso impl√≠cito de `Agente CRM`)* Deber√≠as recibir una invitaci√≥n al calendario en [Correo] pronto. ¬°Hablamos entonces!\"\n\n---\n\n## 6. Verificaciones finales\n\n- Cumple con el flujo de estados.\n- **Usa `Agente CRM` inmediatamente despu√©s de recolectar los datos de contacto y despu√©s de una reserva exitosa.**\n- Usa `Agente Calendario` solo en el estado AGENDAMIENTO con los requisitos cumplidos.\n- Respeta estrictamente las reglas de comunicaci√≥n y las fuentes de conocimiento definidas.\n\n**IMPORTANTE:** Fecha y hora actual: {{ $now }}  \n**IMPORTANTE:** Disparador: {{ $json.trigger }}\n\n---\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1960,1020],"id":"68c2fa77-fe70-46a6-b573-5e1064e8b6a8","name":"AI Agent"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"89b54b27-2f6d-4c16-b3ed-b539bdcf9a4f","leftValue":"={{ $('Intermediario').item.json.trigger }}","rightValue":"whatsapp","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"whatsapp"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"9df0a1da-742d-4ac6-b4f8-a76006c314db","leftValue":"={{ $('Intermediario').item.json.trigger }}","rightValue":"facebook","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"facebook"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"98550c9d-4266-4694-8d5a-a3972d6aad22","leftValue":"={{ $('Intermediario').item.json.trigger }}","rightValue":"instagram","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"instagram"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2420,1180],"id":"8d933ec4-2eb2-4ee2-b4bf-e88bad4b727b","name":"Switch"},{"parameters":{"content":"# AGENTE","height":580,"width":1040,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1600,940],"id":"fe0ffecb-d8e8-4f88-a47a-300c1efda083","name":"Sticky Note8"},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1960,1320],"id":"5957c505-4af7-4043-8be5-168bd6e812d5","name":"Postgres Chat Memory"},{"parameters":{"assignments":{"assignments":[{"id":"84dc8840-97a0-47d4-8a18-0608a1b357ae","name":"trigger","value":"whatsapp","type":"string"},{"id":"9a46b726-e9aa-4cb5-8c1a-d6d38b920908","name":"texto","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"e2b7a6a0-2677-4b56-b037-f010efb6da46","name":"sessionId","value":"={{ $('Postgres').item.json.whatsapp }}","type":"string"},{"id":"bca35569-12c5-443e-8e08-c9f8718cd31a","name":"extraPrompt","value":"=Esta es la informacion del lead:\nNombre: {{ $json.nombre_oportunidad }}\nVeh√≠culo: {{ $json.modelo_marca_ano }}\nInteresado en: {{ $json.servicio }}\nEmail: {{ $json.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[980,1080],"id":"98c04e98-1cd6-4702-bbb3-cd4afe3fe41b","name":"Edit Fields - chat1"},{"parameters":{"content":"# Whatsapp","height":560,"width":1800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-660,1020],"id":"876d7d45-5876-4ad6-b746-534d7d258f23","name":"Sticky Note11"},{"parameters":{"content":"## Whatsapp","height":540,"width":400,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2840,940],"id":"ea4d3c37-512a-4cb9-a2e0-e4543cab6375","name":"Sticky Note12"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1800,1320],"id":"baacd941-d9df-4287-ac80-caeea7c735c3","name":"OpenAI Chat Model"},{"parameters":{"httpMethod":"POST","path":"prueba","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-640,1300],"id":"766f0d27-fc0e-447d-a379-8e0cf6cdb1f7","name":"Webhook","webhookId":"1257b62a-7fe3-453a-808a-3fd6ea8bbfc6"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7600cd39-f566-4fa5-a7e0-b29e05b392bd","leftValue":"={{ $json.body.event }}","rightValue":"messages.upsert","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"908caaea-a2fa-4184-a052-061f3f4c0f17","leftValue":"={{ $json.body.data.key.fromMe }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-460,1300],"id":"fdf0e4aa-2154-41aa-a9ec-53ce15ba6970","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"b1373777-68c4-4d3e-8eae-c77269e2163d","name":"Whatsapp_number","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"b3a441af-a709-4998-98ed-887fa21983cd","name":"Whastapp_name","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"c5600e5f-cfd4-466c-baf9-dc42ea14edb1","name":"message_id","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"135da444-8b73-4671-abaf-22e1825ede87","name":"message_type","value":"={{ !!$json.body.data.message.conversation && 'Texto' ||\n   !!$json.body.data.message.audioMessage && 'audio' ||\n   !!$json.body.data.message.imageMessage && 'image' ||\n   !!$json.body.data.message.stickerMessage && 'sticker' }}","type":"string"},{"id":"2797e7c1-0128-4d92-9a62-167b97a8a832","name":"message_receivedDate","value":"={{ DateTime.fromSeconds($json.body.data.messageTimestamp).toISO() }}","type":"string"},{"id":"b10b61c5-c8fa-414a-93fe-c8c0fa35aa7a","name":"apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"7a9960cb-1f18-4c42-835d-4be20219affb","name":"instancia","value":"={{ $json.body.instance }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-240,1280],"id":"725029d8-ab3b-4c82-994e-b4c828be35c6","name":"Edit Fields"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Edit Fields').item.json.message_type }}","rightValue":"Texto","operator":{"type":"string","operation":"equals"},"id":"b1a72f7a-4217-46be-8791-e0b42ae36108"}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"077cd860-da61-4973-b37d-2c34d2cf9de9","leftValue":"={{ $('Edit Fields').item.json.message_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"97b51420-cf22-4718-8256-bd2bd0a3c6e6","leftValue":"={{ $('Edit Fields').item.json.message_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e46a4113-4b7f-4e4c-a44f-0047f86f6f13","leftValue":"={{ $('Edit Fields').item.json.message_type }}","rightValue":"sticker","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Sticker"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[200,1240],"id":"fbe88021-e9aa-4550-bc70-26e3dc0aa640","name":"Switch1"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[820,1300],"id":"30b69db9-967c-40ba-a327-75d06a4ddb54","name":"OpenAI"},{"parameters":{"assignments":{"assignments":[{"id":"6c0c61ff-4a2d-436c-ac64-35e63c0a7aa4","name":"audio64","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,1300],"id":"4b891076-d3f1-4660-a28e-5c7e70d23529","name":"Edit Fields4"},{"parameters":{"operation":"toBinary","sourceProperty":"audio64","options":{"fileName":"=file-{{ $now.format('yyyy-MM-dd:dd_HHMMSS') }}.ogg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[660,1300],"id":"2ea30c95-fcd3-4101-83eb-8c49fa507389","name":"Convert to File1"},{"parameters":{"resource":"messages-api","instanceName":"Prueba","remoteJid":"=34{{ $('Intermediario').item.json.sessionId }}@s.whatsapp.net","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[2980,1140],"id":"e02390f7-71e7-4a11-98a5-15fa8f6c1552","name":"Evolution API1"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1360,1180],"id":"6204c405-4130-4fc6-8fa6-69f1a5be370c","name":"Intermediario"},{"parameters":{"content":"# Formulario con SQL","height":440,"width":1480,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-660,-140],"id":"48b49bbd-3250-4b55-a26e-d2841000c1c7","name":"Sticky Note"},{"parameters":{"name":"crmAgent","description":"Call this tool to take any action from CRM","workflowId":{"__rl":true,"value":"fTYqfpH3eoEWsKJq","mode":"list","cachedResultName":"Sub-Agente CRM"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}","phone":"={{ $('Intermediario').item.json.sessionId }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"phone","displayName":"phone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[2140,1320],"id":"0035d5de-8f0c-4e87-926f-59698e247f73","name":"CRM Agente"},{"parameters":{"name":"calendarAgent","description":"Use this tool to schedule a consultation appointment in the calendar. You must provide the attendee's email address and the proposed start time in ISO 8601 format. You can optionally provide the attendee's name and a summary.\n\n","workflowId":{"__rl":true,"value":"b95gCMx3edDWSqr2","mode":"list","cachedResultName":"Sub-Agente Calendario"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[2320,1320],"id":"21dfb0dd-a9be-4888-927c-72f6d3af8be1","name":"Agente Calendario"},{"parameters":{"path":"46033e15-94e9-4733-a8da-5a248bff9b66","formTitle":"¬°Cotiza tu servicio mec√°nico por WhatsApp!","formDescription":"<p>D√©janos tus datos y te contactaremos al instante por WhatsApp con toda la info que necesitas.</p>","formFields":{"values":[{"fieldLabel":"Tu nombre","placeholder":"Ej. Juan P√©rez","requiredField":true},{"fieldLabel":"Email","fieldType":"email","placeholder":"juanperez@gmail.com","requiredField":true},{"fieldLabel":"Modelo/Marca/A√±o","placeholder":"Ej. Ford Focus 2023","requiredField":true},{"fieldLabel":"¬øQu√© servicio necesitas?","fieldType":"dropdown","fieldOptions":{"values":[{"option":"pel√≠cula de protecci√≥n de pintura (PPF)"},{"option":"recubrimiento cer√°mico"},{"option":"polarizado de vidrios"}]},"requiredField":true},{"fieldLabel":"Placa","placeholder":"Ej. ABC123","requiredField":true},{"fieldLabel":"Numero de Whatsapp","placeholder":"Ej. 3001234567","requiredField":true}]},"options":{}},"name":"Formulario1","type":"n8n-nodes-base.formTrigger","typeVersion":1,"position":[-580,580],"id":"ee228ac9-1ed5-43b3-a0e4-6fd4d3e24a25","webhookId":"46033e15-94e9-4733-a8da-5a248bff9b66"},{"parameters":{"content":"# Formulario con modulos","height":440,"width":1100,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-660,420],"id":"cf86168a-59cd-4b3b-b30e-1367079fec08","name":"Sticky Note1"},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"contactos","mode":"list","cachedResultName":"contactos"},"dataMode":"defineBelow","columnToMatchOn":"whatsapp","valueToMatchOn":"={{ $json['Numero de Whatsapp'] }}","valuesToSend":{"values":[{"column":"nombre","value":"={{ $json['Tu nombre'] }}"},{"column":"email","value":"={{ $json.Email }}"},{"column":"servicio","value":"={{ $json['¬øQu√© servicio necesitas?'] }}"},{"column":"id_coche","value":"={{ $json.Placa }}"}]},"options":{}},"name":"Crea o actualizar","type":"n8n-nodes-base.postgres","typeVersion":2,"position":[-300,580],"id":"ca7dd55a-32bf-46b2-bf25-a57a18e43534"},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"oportunidades","mode":"list","cachedResultName":"oportunidades"},"columns":{"mappingMode":"defineBelow","value":{"nombre_oportunidad":"={{ $('Formulario1').item.json['Tu nombre'] }}","estado":"Calificaci√≥n","servicio":"={{ $('Formulario1').item.json['¬øQu√© servicio necesitas?'] }}","fecha_cierre":"={{ $now.plus(7, 'days') }}","modelo_marca_ano":"={{ $('Formulario1').item.json['Modelo/Marca/A√±o'] }}","email":"={{ $('Formulario1').item.json.Email }}","whatsapp":"={{ $('Formulario1').item.json['Numero de Whatsapp'] }}","id":0},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"nombre_oportunidad","displayName":"nombre_oportunidad","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"estado","displayName":"estado","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"whatsapp","displayName":"whatsapp","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"servicio","displayName":"servicio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"proposal","displayName":"proposal","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fecha_cierre","displayName":"fecha_cierre","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"modelo_marca_ano","displayName":"modelo_marca_ano","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"email","displayName":"email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-20,580],"id":"790374e1-7c0b-429c-8381-0aa6d52085ab","name":"Crea Oportunidad"},{"parameters":{"resource":"messages-api","instanceName":"Prueba","remoteJid":"=34{{ $('Formulario1').item.json['Numero de Whatsapp'] }}@s.whatsapp.net","messageText":"=üëã ¬°Hola {{ $('Formulario1').item.json['Tu nombre'] }}! Gracias por completar el formulario de nuestro taller üõ†Ô∏èüöó  \n\nüìÑ Recibimos tu solicitud para el veh√≠culo: *{{ $('Formulario1').item.json['Modelo/Marca/A√±o'] }}*   \nüî¢ Placa: *{{ $('Formulario1').item.json.Placa }}*   \nüß∞ Servicio requerido: *{{ $('Formulario1').item.json['¬øQu√© servicio necesitas?'] }}*  \n\n¬øTe gustar√≠a que te enviemos m√°s informaci√≥n o una cotizaci√≥n por este medio? üí¨üì≤","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[220,580],"id":"f3e63b80-8a95-4c80-aa5f-b473ef44cd8b","name":"Enviar Whatsapp"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"oportunidades","mode":"list","cachedResultName":"oportunidades"},"where":{"values":[{"column":"whatsapp","value":"={{ $json.Whatsapp_number.replace(34,\"\").replace(\"@s.whatsapp.net\",\"\") }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-20,1280],"id":"1d841ae2-ed73-4b99-973c-429e7cdfb5fe","name":"Postgres"},{"parameters":{"assignments":{"assignments":[{"id":"84dc8840-97a0-47d4-8a18-0608a1b357ae","name":"trigger","value":"whatsapp","type":"string"},{"id":"9a46b726-e9aa-4cb5-8c1a-d6d38b920908","name":"texto","value":"=transcripcion","type":"string"},{"id":"e2b7a6a0-2677-4b56-b037-f010efb6da46","name":"sessionId","value":"={{ $('Postgres').item.json.whatsapp }}","type":"string"},{"id":"bca35569-12c5-443e-8e08-c9f8718cd31a","name":"extraPrompt","value":"=Esta es la informacion del lead:\nNombre: {{ $json.nombre_oportunidad }}\nVeh√≠culo: {{ $json.modelo_marca_ano }}\nInteresado en: {{ $json.servicio }}\nEmail: {{ $json.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1000,1300],"id":"bf0e2596-84ff-4add-a480-865348fd97c3","name":"Edit Fields - chat"},{"parameters":{"mode":"retrieve-as-tool","toolName":"test","toolDescription":"tesrt","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.1,"position":[1480,1340],"id":"f7cf2603-8021-4e19-8ec7-0c19d0048320","name":"Supabase Vector Store"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1560,1540],"id":"a7a2d879-1fd2-47fd-8088-170bf0f4734c","name":"Embeddings OpenAI"}],"connections":{"Formulario":{"main":[[{"node":"Buscar Cliente","type":"main","index":0}]]},"Buscar Cliente":{"main":[[{"node":"Si Existe","type":"main","index":0}]]},"Si Existe":{"main":[[{"node":"Crear Cliente","type":"main","index":0}],[{"node":"Crear Oportunidad","type":"main","index":0}]]},"Crear Cliente":{"main":[[{"node":"Crear Oportunidad","type":"main","index":0}]]},"Crear Oportunidad":{"main":[[{"node":"Evolution API","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Evolution API1","type":"main","index":0}],[],[]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Edit Fields - chat1":{"main":[[{"node":"Intermediario","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Webhook":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Postgres","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"Edit Fields - chat","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Edit Fields - chat1","type":"main","index":0}],[{"node":"Edit Fields4","type":"main","index":0}]]},"Intermediario":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"CRM Agente":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Agente Calendario":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Formulario1":{"main":[[{"node":"Crea o actualizar","type":"main","index":0}]]},"Crea o actualizar":{"main":[[{"node":"Crea Oportunidad","type":"main","index":0}]]},"Crea Oportunidad":{"main":[[{"node":"Enviar Whatsapp","type":"main","index":0}]]},"Postgres":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Edit Fields - chat":{"main":[[{"node":"Intermediario","type":"main","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"Formulario":[{"json":{"Tu nombre":"Angel Aparicio","Email":"angel.aparicio92@gmail.com","Modelo/Marca/A√±o":"Seat Tarraco 2021 2.0","¬øQu√© servicio necesitas?":"polarizado de vidrios","Placa":"6574TFH","Numero de Whatsapp":"722418242","submittedAt":"2025-05-14T18:49:11.092Z","formMode":"production"}}],"Formulario1":[{"json":{"Tu nombre":"Angel Aparicio","Email":"angel.aparicio92@gmail.com","Modelo/Marca/A√±o":"Seat Tarraco 2021 2.0","¬øQu√© servicio necesitas?":"polarizado de vidrios","Placa":"6574TFH","Numero de Whatsapp":"722418242","submittedAt":"2025-05-14T18:49:11.092Z","formMode":"production"}}]},"versionId":"6f384b26-3eda-467b-ac19-9556da97e7e7","triggerCount":0,"shared":[{"updatedAt":"2025-06-16T12:47:51.046Z","createdAt":"2025-06-16T12:47:51.046Z","role":"workflow:owner","workflowId":"mrDLjQ3c4KHaalz9","projectId":"BlSED80HESP48veq"}],"tags":[]}