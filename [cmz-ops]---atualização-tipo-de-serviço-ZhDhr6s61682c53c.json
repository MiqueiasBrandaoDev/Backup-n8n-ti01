{"updatedAt":"2025-09-03T18:49:54.531Z","createdAt":"2025-09-01T15:39:56.942Z","id":"ZhDhr6s61682c53c","name":"[Cmz-ops] - Atualização Tipo de serviço","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,-240],"id":"e8898e64-87bc-468d-8525-3c856085b0c4","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/9b78b412-f459-4e23-8ee8-c00a0daba311","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,-240],"id":"4c0c18ba-995c-4418-a06e-f4bfbfe4eada","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) — RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = '9b78b412-f459-4e23-8ee8-c00a0daba311'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'cmz_tipo_de_serviço';                         // nome do campo (mantém)\nconst UNIQUE_NAME = 'Não Cadastrado';                        // única opção que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da opção\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,-240],"id":"d0f496fe-6c06-4d0f-aa3c-d5ac8396a290","name":"Code Reset1"},{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/49/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-528],"id":"f91b6a74-43c1-4a74-9d52-5f1dcbc2039c","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-720],"id":"c873a1f2-85f9-4e59-8b23-b2ace99d4e01","name":"All Clients"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY5MjUzMDcsImV4cCI6MTc1NzA5ODEwN30.-iCr7xnJnUA7ONW_JpVniTqhmCo-ULzj0V6G71Sift0","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-576],"id":"60477522-12c1-42dd-8ea9-b6693df8aeb0","name":"ultimo cliente id1"},{"parameters":{"jsCode":"const MIN_ID = 3; // <<< ajuste aqui se precisar\nconst lastId = Number($input.first().json[\"entrie-id\"] ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"eba62b42-7514-4b3d-9657-c4c3482b2c48","name":"Code - Gerar IDs (lastId → 0)1","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-576]},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-576],"id":"ef1e5744-25c0-4dc2-88be-b210e58ff388","name":"Loop Over Items1"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/9b78b412-f459-4e23-8ee8-c00a0daba311","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-720],"id":"b25e8e88-9fe3-4b59-9a6a-269c8f9d370d","name":"List Clientes - Cognito4","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/9b78b412-f459-4e23-8ee8-c00a0daba311","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,-816],"id":"92e52c25-4a53-4e7c-bf57-728fef208a82","name":"List Clientes - Cognito5"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas opções\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// opções já existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia RazãoSocial (com alguns aliases de segurança)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['TipoDeServiço'] ??\n    i.json?.razaoSocial ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[864,-816],"id":"80a553d9-fba8-4a8c-90f7-533130bb378b","name":"Code1"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-768],"typeVersion":1,"id":"096c3280-ea52-4c01-8fee-2be08813686e","name":"Sticky Note1"},{"parameters":{"httpMethod":"POST","path":"7Zbg4M68reSCKyse8yZo123QBXJa4FVAzf8nWv8lZoEEvYkZMU1Lc0QwVJaWL5IG","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-576],"id":"58d00dd3-d997-4329-86c8-addd6a45123d","name":"Webhook1","webhookId":"8dbc65c7-78f5-484e-8090-bf9046d62290"},{"parameters":{"workflowId":{"__rl":true,"value":"qRNjZyWsJqu8li3F","mode":"list","cachedResultName":"[Cmz-ops] - Notificação de Erro"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1088,-592],"id":"abd2cecd-902f-486f-9e11-a2e2bdd2a54e","name":"Execute Workflow1","executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"870401ad-d8d1-48a3-9aca-e183adc753ec","name":"json","value":"={{ $workflow }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,-592],"id":"7332eadc-97fa-4ee7-8b90-76f82c670c0f","name":"Edit Fields1","executeOnce":true}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito4","type":"main","index":0}]]},"ultimo cliente id1":{"main":[[{"node":"Code - Gerar IDs (lastId → 0)1","type":"main","index":0}]]},"Code - Gerar IDs (lastId → 0)1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito4":{"main":[[{"node":"Code1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"List Clientes - Cognito5","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"ultimo cliente id1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"global":{"results":[],"failed":[{"id":null},{"id":null},{"id":null},{"id":null},{"id":null}]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook1":[{"json":{"headers":{"host":"primary-production-70c40.up.railway.app","user-agent":"CognitoForms","content-length":"1680","content-type":"application/json","expect":"100-continue","request-id":"|3818876b-27bc-479d-8709-7f4c624b1fae.771ac9940255ca84.","traceparent":"00-71a27117eb55e3f7d50a09b7b15077a1-771ac9940255ca84-00","x-forwarded-for":"4.156.104.40","x-forwarded-host":"primary-production-70c40.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4-eqdc4a","x-railway-request-id":"GOrbpk6ISEKouuj_woOzXw","x-real-ip":"4.156.104.40","x-request-start":"1756925114137","x-requested-with":"XMLHttpRequest","accept-encoding":"gzip"},"params":{},"query":{},"body":{"Form":{"Id":"49","InternalName":"TiposDeServiço","Name":"Tipos de Serviço"},"TipoDeServiço":"Due Dilligence","TempoEstimado":"120m","PrazoemDias":"4","Entry":{"AdminLink":"https://www.cognitoforms.com/CláudioCamozzi/49/entries/155","DateCreated":"2025-09-03T18:45:12.671Z","DateSubmitted":"2025-09-03T18:45:12.671Z","DateUpdated":"2025-09-03T18:45:12.671Z","EditLink":"https://www.cognitoforms.com/CláudioCamozzi/TiposDeServiço#BefBzaBD57yD_2XoG_j0JAqDvKiaUsEDDISuzri6C98$*","Number":155,"Order":null,"Origin":{"City":null,"CountryCode":null,"IpAddress":"187.58.58.203","IsImported":false,"Region":null,"Timezone":null,"UserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36"},"Timestamp":"2025-09-03T18:45:12.671Z","User":{"Email":"ti01@camozziconsultoria.com.br","Name":"Miqueias Brandão"},"Version":1,"ViewLink":"https://www.cognitoforms.com/CláudioCamozzi/TiposDeServiço#SF3GHo6C0krV7GwKfy7zCsz8a7Zrwo7pHBGv67uhYA0$*","Action":"Submeter","Role":"Public","Status":"Submitted","PublicLink":"https://www.cognitoforms.com/CláudioCamozzi/TiposDeServiço#sN21tNXgJlWVzAELsFgBn7dnTu4G7hZPdqxYTy-ruKg$*","InternalLink":"https://www.cognitoforms.com/CláudioCamozzi/TiposDeServiço#dm-fwMN3jFoDKwMsWGYOu3JBrtD7vZKjJpn1bNLCefs$*","ReviewerLink":"https://www.cognitoforms.com/CláudioCamozzi/TiposDeServiço#v887Ud9fgfUsI076Lh9SKAABcsMOaT305GgrZonuwJM$*","Document1":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=fLBMpgL2cSi_utShYac0Slx2A93a50G0_AX8CB68L9E$","Document2":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=ERHNMvh5mXQ9IhcFBQbaQuIMH5f3rRFCNwg862NcX7k$"},"Id":"49-155"},"webhookUrl":"https://primary-production-70c40.up.railway.app/webhook/7Zbg4M68reSCKyse8yZo123QBXJa4FVAzf8nWv8lZoEEvYkZMU1Lc0QwVJaWL5IG","executionMode":"production"}}]},"versionId":"bd311d16-75b9-4572-b2e0-7f5d872af86c","activeVersionId":"bd311d16-75b9-4572-b2e0-7f5d872af86c","triggerCount":1,"shared":[{"updatedAt":"2025-09-01T15:39:56.942Z","createdAt":"2025-09-01T15:39:56.942Z","role":"workflow:owner","workflowId":"ZhDhr6s61682c53c","projectId":"BlSED80HESP48veq"}],"activeVersion":{"updatedAt":"2025-12-01T11:56:54.083Z","createdAt":"2025-12-01T11:56:54.083Z","versionId":"bd311d16-75b9-4572-b2e0-7f5d872af86c","workflowId":"ZhDhr6s61682c53c","nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,-240],"id":"e8898e64-87bc-468d-8525-3c856085b0c4","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/9b78b412-f459-4e23-8ee8-c00a0daba311","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,-240],"id":"4c0c18ba-995c-4418-a06e-f4bfbfe4eada","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) — RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = '9b78b412-f459-4e23-8ee8-c00a0daba311'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'cmz_tipo_de_serviço';                         // nome do campo (mantém)\nconst UNIQUE_NAME = 'Não Cadastrado';                        // única opção que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da opção\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,-240],"id":"d0f496fe-6c06-4d0f-aa3c-d5ac8396a290","name":"Code Reset1"},{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/49/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-528],"id":"f91b6a74-43c1-4a74-9d52-5f1dcbc2039c","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-720],"id":"c873a1f2-85f9-4e59-8b23-b2ace99d4e01","name":"All Clients"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY5MjUzMDcsImV4cCI6MTc1NzA5ODEwN30.-iCr7xnJnUA7ONW_JpVniTqhmCo-ULzj0V6G71Sift0","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-576],"id":"60477522-12c1-42dd-8ea9-b6693df8aeb0","name":"ultimo cliente id1"},{"parameters":{"jsCode":"const MIN_ID = 3; // <<< ajuste aqui se precisar\nconst lastId = Number($input.first().json[\"entrie-id\"] ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"eba62b42-7514-4b3d-9657-c4c3482b2c48","name":"Code - Gerar IDs (lastId → 0)1","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-576]},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-576],"id":"ef1e5744-25c0-4dc2-88be-b210e58ff388","name":"Loop Over Items1"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/9b78b412-f459-4e23-8ee8-c00a0daba311","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-720],"id":"b25e8e88-9fe3-4b59-9a6a-269c8f9d370d","name":"List Clientes - Cognito4","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/9b78b412-f459-4e23-8ee8-c00a0daba311","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id1').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,-816],"id":"92e52c25-4a53-4e7c-bf57-728fef208a82","name":"List Clientes - Cognito5"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas opções\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// opções já existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia RazãoSocial (com alguns aliases de segurança)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['TipoDeServiço'] ??\n    i.json?.razaoSocial ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[864,-816],"id":"80a553d9-fba8-4a8c-90f7-533130bb378b","name":"Code1"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-768],"typeVersion":1,"id":"096c3280-ea52-4c01-8fee-2be08813686e","name":"Sticky Note1"},{"parameters":{"httpMethod":"POST","path":"7Zbg4M68reSCKyse8yZo123QBXJa4FVAzf8nWv8lZoEEvYkZMU1Lc0QwVJaWL5IG","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-576],"id":"58d00dd3-d997-4329-86c8-addd6a45123d","name":"Webhook1","webhookId":"8dbc65c7-78f5-484e-8090-bf9046d62290"},{"parameters":{"workflowId":{"__rl":true,"value":"qRNjZyWsJqu8li3F","mode":"list","cachedResultName":"[Cmz-ops] - Notificação de Erro"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1088,-592],"id":"abd2cecd-902f-486f-9e11-a2e2bdd2a54e","name":"Execute Workflow1","executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"870401ad-d8d1-48a3-9aca-e183adc753ec","name":"json","value":"={{ $workflow }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,-592],"id":"7332eadc-97fa-4ee7-8b90-76f82c670c0f","name":"Edit Fields1","executeOnce":true}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito4","type":"main","index":0}]]},"ultimo cliente id1":{"main":[[{"node":"Code - Gerar IDs (lastId → 0)1","type":"main","index":0}]]},"Code - Gerar IDs (lastId → 0)1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito4":{"main":[[{"node":"Code1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"List Clientes - Cognito5","type":"main","index":0}]]},"Webhook1":{"main":[[{"node":"ultimo cliente id1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}