{"updatedAt":"2025-12-16T13:19:42.004Z","createdAt":"2025-08-26T15:47:02.408Z","id":"m5G2MkhkITS1kZJI","name":"[Cmz-ops] - Atualiza√ß√£o Clientes","active":true,"isArchived":false,"nodes":[{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/51/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-64],"id":"5f304678-1e61-4e4a-be81-279f4614a929","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-112],"id":"9c23b63e-13a2-4f25-a9f0-b359633037da","name":"ultimo cliente id"},{"parameters":{"jsCode":"const MIN_ID = 36; // <<< ajuste aqui se precisar\nconst lastId = Number($input.first().json[\"entrie-id\"] ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"8fe7d269-f0e1-4e9d-8628-d060cea53ca2","name":"Code - Gerar IDs (lastId ‚Üí 0)","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-112]},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-112],"id":"25be453f-d482-43fb-8e7d-f887f0034951","name":"Loop Over Items"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-256],"id":"830a3636-5809-4ca8-a310-7f449539f755","name":"All Clients"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-256],"id":"d8b517a8-7af9-4461-badf-e236e52325c9","name":"List Clientes - Cognito1","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,-352],"id":"f43ec49f-82b6-4024-a501-a9cddef1fe87","name":"List Clientes - Cognito2"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas op√ß√µes\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// op√ß√µes j√° existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia Raz√£oSocial (com alguns aliases de seguran√ßa)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['Raz√£oSocial'] ??\n    i.json?.razaoSocial ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[864,-352],"id":"8f3729cd-fa63-4db6-94d1-1c9a427c57a5","name":"Code"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-304],"typeVersion":1,"id":"9c04c7fb-8fae-4878-ae5a-180cf58b7056","name":"Sticky Note"},{"parameters":{"httpMethod":"POST","path":"8dbc65c7-78f5-484e-8090-bf9046d62290","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-112],"id":"b75de3c9-3280-4b75-9d1c-81c6b7cbc349","name":"Webhook","webhookId":"8dbc65c7-78f5-484e-8090-bf9046d62290"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,192],"id":"a5a86739-5258-4360-be33-5715f6a600cc","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,192],"id":"1a62af53-926d-4081-8503-50673d1df44a","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) ‚Äî RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = '23fd2c36-e70e-4f9f-971a-86ed77c46a57'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'üôã‚Äç‚ôÇÔ∏è Cliente';                         // nome do campo (mant√©m)\nconst UNIQUE_NAME = 'N√£o Cadastrado';                        // √∫nica op√ß√£o que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da op√ß√£o\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,192],"id":"60bf9c48-29db-4524-97a4-3f8ecb50cea4","name":"Code Reset1"},{"parameters":{"workflowId":{"__rl":true,"value":"qRNjZyWsJqu8li3F","mode":"list","cachedResultUrl":"/workflow/qRNjZyWsJqu8li3F","cachedResultName":"[Cmz-ops] - Notifica√ß√£o de Erro"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1088,-128],"id":"454dc78e-8087-4a5e-89ce-32048d86b21c","name":"Execute Workflow","executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"870401ad-d8d1-48a3-9aca-e183adc753ec","name":"json","value":"={{ $workflow }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,-128],"id":"0ebdc20f-fdda-4c9a-bf41-aafb020d68a8","name":"Edit Fields","executeOnce":true}],"connections":{"ultimo cliente id":{"main":[[{"node":"Code - Gerar IDs (lastId ‚Üí 0)","type":"main","index":0}]]},"Code - Gerar IDs (lastId ‚Üí 0)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"List Clientes - Cognito1":{"main":[[{"node":"Code","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]},"Code":{"main":[[{"node":"List Clientes - Cognito2","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito1","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"ultimo cliente id","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"global":{"results":[],"failed":[{"id":null},{"id":null},{"id":null},{"id":null},{"id":null},{"id":null}]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"primary-production-70c40.up.railway.app","user-agent":"CognitoForms","content-length":"2818","content-type":"application/json","expect":"100-continue","request-id":"|16144612-783e-4ea3-995d-4b4c2af507d5.07048316bbee8710.","traceparent":"00-31eb167554725385b878ee44ace10ee3-07048316bbee8710-00","x-forwarded-for":"4.156.104.40","x-forwarded-host":"primary-production-70c40.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4-eqdc4a","x-railway-request-id":"HiI1pjyDSuO8Da7zBT7zVQ","x-real-ip":"4.156.104.40","x-request-start":"1765890929014","x-requested-with":"XMLHttpRequest","accept-encoding":"gzip"},"params":{},"query":{},"body":{"Form":{"Id":"51","InternalName":"Clientes","Name":"Clientes"},"Raz√£oSocial":"CERTTUS LTDA","NomeDoS√≥cioAdministrador":"LUCAS RICARDO MEGGIOLARO","Endere√ßo":{"City":null,"CityStatePostalCode":"","Country":"Brasil","CountryCode":"BR","FullAddress":"","FullInternationalAddress":"Brasil","Latitude":null,"Line1":null,"Line2":"","Line3":null,"Longitude":null,"PostalCode":null,"State":null,"StreetAddress":"","Type":"Home"},"TelefonePrincipal":null,"TelefoneSecund√°rio":null,"EmailPrincipal":null,"EmailSecund√°rio":null,"StatusFinanceiro":"Pontual","CNPJ":"00.477.660/0001-68","CPFDoS√≥cioAdministrador":"033.919.189-93","Contratos":[{"ContentType":"application/pdf","Id":"F-2MAidwtGH28s8TOvluDueu","IsEncrypted":false,"Name":"Certtus_Proposta Comercial_Assinado.pdf","Size":463059,"File":"https://www.cognitoforms.com/fa/HAlBTQyV4kezA48rf0XZiA?token=50saIX1JYnqaRhQ1tGXKyucedtYECyVjDAc5x-K3aoCCnRcEoxezjjnF4A30oHh_TE9-9kQUvweXn8uzzmvUvg$$&redirect=0"}],"DocumentosPessoaisConstitutivos":[{"ContentType":"application/pdf","Id":"F-!JeMbZGQ9o4FcpRJflejkk","IsEncrypted":false,"Name":"12a Altera√ß√£o - CERTTUS.pdf","Size":971936,"File":"https://www.cognitoforms.com/fa/HAlBTQyV4kezA48rf0XZiA?token=zSskE3hq_WJiRWAI5rOE94NzUyCMK_7wCor9bjVsrgmxaGc89ycZPmR8ore0MGqwHCk8QfMD7t1mYKyhG8L9gQ$$&redirect=0"}],"Observa√ß√µes":null,"Entry":{"AdminLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/51/entries/184","DateCreated":"2025-12-16T13:15:27.274Z","DateSubmitted":"2025-12-16T13:15:27.274Z","DateUpdated":"2025-12-16T13:15:27.274Z","EditLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#SJjf5zNnEAvYylb_3uXhPJlR4-yhcMxb-TqreFo2C_A$*","Number":184,"Order":null,"Origin":{"City":null,"CountryCode":null,"IpAddress":"187.58.58.203","IsImported":false,"Region":null,"Timezone":null,"UserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"},"Timestamp":"2025-12-16T13:15:27.274Z","User":{"Email":"juridico06@camozziconsultoria.com.br","Name":"Jamilly Carvalho"},"Version":1,"ViewLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#KzwB-017L4tMtoJFSGXsgb9dIfmM23o-lJkE9ROmZr4$*","Action":"Submeter","Role":"Public","Status":"Submitted","PublicLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#tzIjqeEqqAayphrTzt5-c2YQC-q-nybztVVdltY2fr4$*","InternalLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#RPGfkb7jyEqtdJt8Plz3ekiI98oMVSXtgyba_CDenxQ$*","ReviewerLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#GlhJYqK2Ji3AlwX5tVJ71PmePEGXssmKCxAYvWQiQsA$*","Document1":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=FF1rsAkjVHdVthnbCHj9aNVPRt15o7NzO0OmWVpiejA$","Document2":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=Y_NSN8XzkFqOilrEcZkmwgT9CzjLmTpmeVCvgQUr6Cc$"},"Id":"51-184"},"webhookUrl":"https://primary-production-70c40.up.railway.app/webhook/8dbc65c7-78f5-484e-8090-bf9046d62290","executionMode":"production"}}]},"versionId":"ef0d2f0e-1c0d-4115-913e-5a4c39a345dc","activeVersionId":"ef0d2f0e-1c0d-4115-913e-5a4c39a345dc","triggerCount":1,"shared":[{"updatedAt":"2025-08-26T15:47:02.408Z","createdAt":"2025-08-26T15:47:02.408Z","role":"workflow:owner","workflowId":"m5G2MkhkITS1kZJI","projectId":"BlSED80HESP48veq"}],"activeVersion":{"updatedAt":"2025-12-16T13:19:41.978Z","createdAt":"2025-12-16T13:19:41.978Z","versionId":"ef0d2f0e-1c0d-4115-913e-5a4c39a345dc","workflowId":"m5G2MkhkITS1kZJI","nodes":[{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/51/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-64],"id":"5f304678-1e61-4e4a-be81-279f4614a929","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-112],"id":"9c23b63e-13a2-4f25-a9f0-b359633037da","name":"ultimo cliente id"},{"parameters":{"jsCode":"const MIN_ID = 36; // <<< ajuste aqui se precisar\nconst lastId = Number($input.first().json[\"entrie-id\"] ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"8fe7d269-f0e1-4e9d-8628-d060cea53ca2","name":"Code - Gerar IDs (lastId ‚Üí 0)","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-112]},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-112],"id":"25be453f-d482-43fb-8e7d-f887f0034951","name":"Loop Over Items"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-256],"id":"830a3636-5809-4ca8-a310-7f449539f755","name":"All Clients"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-256],"id":"d8b517a8-7af9-4461-badf-e236e52325c9","name":"List Clientes - Cognito1","onError":"continueErrorOutput"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,-352],"id":"f43ec49f-82b6-4024-a501-a9cddef1fe87","name":"List Clientes - Cognito2"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas op√ß√µes\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// op√ß√µes j√° existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia Raz√£oSocial (com alguns aliases de seguran√ßa)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['Raz√£oSocial'] ??\n    i.json?.razaoSocial ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[864,-352],"id":"8f3729cd-fa63-4db6-94d1-1c9a427c57a5","name":"Code"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-304],"typeVersion":1,"id":"9c04c7fb-8fae-4878-ae5a-180cf58b7056","name":"Sticky Note"},{"parameters":{"httpMethod":"POST","path":"8dbc65c7-78f5-484e-8090-bf9046d62290","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-112],"id":"b75de3c9-3280-4b75-9d1c-81c6b7cbc349","name":"Webhook","webhookId":"8dbc65c7-78f5-484e-8090-bf9046d62290"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,192],"id":"a5a86739-5258-4360-be33-5715f6a600cc","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,192],"id":"1a62af53-926d-4081-8503-50673d1df44a","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) ‚Äî RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = '23fd2c36-e70e-4f9f-971a-86ed77c46a57'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'üôã‚Äç‚ôÇÔ∏è Cliente';                         // nome do campo (mant√©m)\nconst UNIQUE_NAME = 'N√£o Cadastrado';                        // √∫nica op√ß√£o que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da op√ß√£o\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,192],"id":"60bf9c48-29db-4524-97a4-3f8ecb50cea4","name":"Code Reset1"},{"parameters":{"workflowId":{"__rl":true,"value":"qRNjZyWsJqu8li3F","mode":"list","cachedResultUrl":"/workflow/qRNjZyWsJqu8li3F","cachedResultName":"[Cmz-ops] - Notifica√ß√£o de Erro"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1088,-128],"id":"454dc78e-8087-4a5e-89ce-32048d86b21c","name":"Execute Workflow","executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"870401ad-d8d1-48a3-9aca-e183adc753ec","name":"json","value":"={{ $workflow }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,-128],"id":"0ebdc20f-fdda-4c9a-bf41-aafb020d68a8","name":"Edit Fields","executeOnce":true}],"connections":{"ultimo cliente id":{"main":[[{"node":"Code - Gerar IDs (lastId ‚Üí 0)","type":"main","index":0}]]},"Code - Gerar IDs (lastId ‚Üí 0)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"List Clientes - Cognito1":{"main":[[{"node":"Code","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]},"Code":{"main":[[{"node":"List Clientes - Cognito2","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito1","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"ultimo cliente id","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]}},"authors":"Miqueias Brand√£o","name":null,"description":null,"autosaved":false},"tags":[]}