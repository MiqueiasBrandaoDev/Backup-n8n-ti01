{"updatedAt":"2025-09-01T15:26:15.997Z","createdAt":"2025-09-01T14:56:29.488Z","id":"BgeLnVM9uHTmmMNb","name":"[Cmz-ops] - Atualiza√ß√£o Tipo de servi√ßo","active":false,"isArchived":true,"nodes":[{"parameters":{"url":"=https://www.cognitoforms.com/api/forms/51/entries/{{ $json.id }}","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[304,-64],"id":"fa1b3724-5101-4506-b447-9c04b662c5ce","name":"List Clientes - Cognito","retryOnFail":false,"credentials":{"httpBearerAuth":{"id":"h0PcF6RaUiY0NLkd","name":"Cognito Forms"}},"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"d465784c-bc03-4b26-af22-3e92171756d3","name":"entrie-id","value":"={{ $json.body.Entry.Number }}","type":"string"},{"id":"d8dc38ec-165b-4fbc-bf53-34894df43ea1","name":"JWT","value":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTY3MzgzMDgsImV4cCI6MTc1NjkxMTEwOH0.aOWKXZcxcXWO326IzHPcXO-mDAVTOzhI5FzCG9Ebi6w","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-112],"id":"411d3688-a060-4cf9-b140-535271e72513","name":"ultimo cliente id"},{"parameters":{"jsCode":"const MIN_ID = 36; // <<< ajuste aqui se precisar\nconst lastId = Number(177 ?? MIN_ID);\nconst items = [];\nfor (let i = lastId; i >= MIN_ID; i--) {\n  items.push({ json: { id: i } });\n}\nreturn items;"},"id":"4f536cbc-6818-4f6e-925e-4ccab061171b","name":"Code - Gerar IDs (lastId ‚Üí 0)","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-112]},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[80,-112],"id":"83153174-f9b6-4477-906e-65d8aa613ea8","name":"Loop Over Items"},{"parameters":{"jsCode":"const data = $getWorkflowStaticData('global');\nif (!data.results) data.results = [];\nif (!data.failed) data.failed = [];\n\nconst status = $json.statusCode;\n// Pega o id direto do item que entrou no HTTP\nconst id = $json.request?.url?.split('/').pop() || null;\n\nif (status === 200) {\n  data.results.push({ id, ...($json.body ?? {}) });\n} else {\n  data.failed.push({ id, status, body: $json.body });\n}\n\nreturn items;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[304,-256],"id":"acc3a1da-5385-4b3b-a372-cf2fe52aa968","name":"All Clients"},{"parameters":{"url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id').item.json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Accept","value":"application/json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[528,-256],"id":"3e739370-3f45-4889-80ca-2834427fadb5","name":"List Clientes - Cognito1"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('ultimo cliente id').first().json.JWT }}"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[976,-256],"id":"a4f2b268-e593-4ef0-9574-6e26a67b74c7","name":"List Clientes - Cognito2"},{"parameters":{"jsCode":"// Code node (Run Once for All Items)\n\n// cor default pra novas op√ß√µes\nconst COLOR_DEFAULT = '#ffffff';\n\n// --- pega o objeto do campo vindo do GET ---\nlet field = $json;\nif (!field?.type_config) field = $json.body || $json.data || null;\nif (!field?.type_config) throw new Error('GET inesperado: sem type_config');\n\n// op√ß√µes j√° existentes\nconst opts = Array.isArray(field.type_config.options) ? [...field.type_config.options] : [];\nconst existing = new Set(opts.map(o => String(o?.name || '').trim().toLowerCase()));\nlet maxIndex = opts.reduce((m, o) =>\n  Number.isFinite(o?.orderindex) ? Math.max(m, o.orderindex) : m, -1\n);\n\n// --- pega TODOS os itens do node \"All Clients\" ---\nconst clientItems = $items('All Clients', 0) || []; // (nodeName, outputIndex)\n\n// mapeia Raz√£oSocial (com alguns aliases de seguran√ßa)\nconst clientes = clientItems\n  .map(i =>\n    i.json?.['Raz√£oSocial'] ??\n    i.json?.razaoSocial ??\n    i.json?.razao_social ??\n    i.json?.name ??\n    null\n  )\n  .filter(Boolean)\n  .map(s => String(s).trim())\n  .filter(s => s.length > 0);\n\n// adiciona sem duplicar (case-insensitive)\nfor (const name of clientes) {\n  const key = name.toLowerCase();\n  if (existing.has(key)) continue;\n\n  maxIndex += 1;\n  opts.push({\n    id: null,                // backend gera UUID\n    name,\n    color: COLOR_DEFAULT,\n    orderindex: maxIndex,\n  });\n  existing.add(key);\n}\n\n// devolve o campo COMPLETO pronto pro PUT\nfield.type_config.options = opts;\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[752,-256],"id":"ad77ae9f-6f21-4c79-a055-1159d75c4745","name":"Code"},{"parameters":{"content":"# PRECISA PEGAR O TOKEN JWT NO NAVEGADOR DO CLICKUP","width":608},"type":"n8n-nodes-base.stickyNote","position":[-592,-304],"typeVersion":1,"id":"a76fb975-e6bd-4578-b810-194d6f1a9e78","name":"Sticky Note"},{"parameters":{"httpMethod":"POST","path":"bbfbfa46-72f6-472f-b271-cc28658a214c","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-112],"id":"1952b70d-9bb9-4a29-a027-e62fab9e0618","name":"Webhook","webhookId":"bbfbfa46-72f6-472f-b271-cc28658a214c"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-592,160],"id":"54a6155b-ac63-472a-b9d9-f2939f68c6ae","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"method":"PUT","url":"=https://frontdoor-prod-us-east-2-1.clickup.com/customFields/v2/field/23fd2c36-e70e-4f9f-971a-86ed77c46a57","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InNiVkFxWkNGdVJBPSJ9.eyJ1c2VyIjo0Mjk5OTE2NiwidmFsaWRhdGVkIjp0cnVlLCJ3c19rZXkiOiI0MzI1NTE3NDY0Iiwic2Vzc2lvbl90b2tlbiI6dHJ1ZSwid29ya3NwYWNlcyI6W3sidHlwZSI6InBhc3N3b3JkIn1dLCJpYXQiOjE3NTYyMTMyMjksImV4cCI6MTc1NjM4NjAyOX0.ID9-1lgrMgDZDBltmezRG5bokMCOSua3LHeY0n5FdeM"},{"name":"X-Workspace-ID","value":"3052532"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-144,160],"id":"9bdfffe0-b8d6-42f4-9b72-87f6ac851e40","name":"List Clientes - Cognito3"},{"parameters":{"jsCode":"// Code node (Run Once for All Items) ‚Äî RESET DO ZERO\n\n// === CONFIG ===\nconst FIELD_ID    = '23fd2c36-e70e-4f9f-971a-86ed77c46a57'; // id do campo\nconst TEAM_ID     = '3052532';                               // workspace/team_id\nconst FIELD_NAME  = 'üôã‚Äç‚ôÇÔ∏è Cliente';                         // nome do campo (mant√©m)\nconst UNIQUE_NAME = 'N√£o Cadastrado';                        // √∫nica op√ß√£o que vai sobrar\nconst UNIQUE_COLOR = '#ffffff';                              // cor da op√ß√£o\n\n// === PAYLOAD COMPLETO PARA O PUT ===\nconst field = {\n  id: FIELD_ID,\n  name: FIELD_NAME,\n  type: 'drop_down',\n  type_id: 1,\n  type_config: {\n    sorting: 'manual',\n    new_drop_down: true,\n    options: [\n      {\n        id: null,           // null => backend gera UUID\n        name: UNIQUE_NAME,\n        color: UNIQUE_COLOR,\n        orderindex: 0,\n      },\n    ],\n  },\n  values_set: null,\n  description: '',\n  hide_from_guests: false,\n  team_id: TEAM_ID,\n  deleted: false,\n  pinned: true,\n  required: false,\n  private: false,\n  required_on_subtasks: false,\n  inverted_field: false,\n};\n\n// Devolve pronto pro PUT\nreturn [{ json: field }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-368,160],"id":"4bd0dfb9-9049-412a-aca6-06c2d13af823","name":"Code Reset1"}],"connections":{"ultimo cliente id":{"main":[[{"node":"Code - Gerar IDs (lastId ‚Üí 0)","type":"main","index":0}]]},"Code - Gerar IDs (lastId ‚Üí 0)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"All Clients","type":"main","index":0}],[{"node":"List Clientes - Cognito","type":"main","index":0}]]},"List Clientes - Cognito":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"List Clientes - Cognito1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"List Clientes - Cognito2","type":"main","index":0}]]},"All Clients":{"main":[[{"node":"List Clientes - Cognito1","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"ultimo cliente id","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Code Reset1","type":"main","index":0}]]},"Code Reset1":{"main":[[{"node":"List Clientes - Cognito3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"global":{"results":[],"failed":[{"id":null},{"id":null}]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"primary-production-70c40.up.railway.app","user-agent":"CognitoForms","content-length":"3000","content-type":"application/json","expect":"100-continue","request-id":"|e85bf2ba-0849-44bb-91bc-99696805ef34.4fc9cfacfd5a836f.","traceparent":"00-3f0eb46c36a69db247ef80e66167dfe3-4fc9cfacfd5a836f-00","x-forwarded-for":"4.156.104.40","x-forwarded-host":"primary-production-70c40.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4-eqdc4a","x-railway-request-id":"AK05P8teQFmGfydXBT7zVQ","x-real-ip":"4.156.104.40","x-request-start":"1756234332800","x-requested-with":"XMLHttpRequest","accept-encoding":"gzip"},"params":{},"query":{},"body":{"Form":{"Id":"51","InternalName":"Clientes","Name":"Clientes"},"Raz√£oSocial":"teste","NomeDoS√≥cioAdministrador":"miqueias","Endere√ßo":{"City":"goiania","CityStatePostalCode":"goiania, go 74921510","Country":"Brasil","CountryCode":"BR","FullAddress":"r1, goiania, go 74921510","FullInternationalAddress":"r1, goiania, go 74921510, Brasil","Latitude":null,"Line1":"r1","Line2":"","Line3":null,"Longitude":null,"PostalCode":"74921510","State":"go","StreetAddress":"r1","Type":"Home"},"TelefonePrincipal":"62994342576","TelefoneSecund√°rio":null,"EmailPrincipal":"ti01@camozziconsultoria.com.br","EmailSecund√°rio":null,"StatusFinanceiro":"Medium","CNPJ":"0564649787979","CPFDoS√≥cioAdministrador":"04901605143","Contratos":[{"ContentType":"application/pdf","Id":"F-MWjw9FsE02ermKKsRrYgPk","IsEncrypted":false,"Name":"ADAMANTIUM_NOTIFICA√á√ÉO EXTRAJUDICIAL_34.413.301 FRANCIELE PIEDADE TIGRE.pdf","Size":138305,"StorageUrl":null,"File":"https://www.cognitoforms.com/fa/HAlBTQyV4kezA48rf0XZiA?token=dwC6HTDrfdaVURk3gymiGEWPTx_Zpw7zEiFMa59jUsqaDZczunhmto9G03wrkrzRAFX2l07bhtdRJq7asalyeA$$"}],"DocumentosPessoaisConstitutivos":[{"ContentType":"application/pdf","Id":"F-yG9oub$OJIyASfBJOiwuE!","IsEncrypted":false,"Name":"ADAMANTIUM_NOTIFICA√á√ÉO EXTRAJUDICIAL_34.413.301 FRANCIELE PIEDADE TIGRE.pdf","Size":138305,"StorageUrl":null,"File":"https://www.cognitoforms.com/fa/HAlBTQyV4kezA48rf0XZiA?token=OYmYZ1H5zkHEjRSDhPng3GXNevkF3HzV1h_W5dAerj6lUKB-WXFuuVFuhAv6LU9j019pWYyT-UAXjCmf8h_c9A$$"}],"Observa√ß√µes":null,"Entry":{"AdminLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/51/entries/178","DateCreated":"2025-08-26T18:52:11.701Z","DateSubmitted":"2025-08-26T18:52:11.701Z","DateUpdated":"2025-08-26T18:52:11.701Z","EditLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#VX7oQ44QI5aCxjqQDHbB2P6eUE2WNRvugj_Mlaan3HQ$*","Number":178,"Order":null,"Origin":{"City":null,"CountryCode":null,"IpAddress":"189.5.177.16","IsImported":false,"Region":null,"Timezone":null,"UserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36"},"Timestamp":"2025-08-26T18:52:11.701Z","User":{"Email":"ti01@camozziconsultoria.com.br","Name":"Miqueias Brand√£o"},"Version":1,"ViewLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#Jy6oksYvnvgyt9X7WCF3YxvHTATCQfxj8DQ4khSo0ts$*","Action":"Submeter","Role":"Public","Status":"Submitted","PublicLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#CGXxq1DnsL68PteAQ-MTKIBEQyAZOzX_9owZkALbwmc$*","InternalLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#pzjxGWrz7Qr7LscbLh603y2c2lfD5vDtvxAdBw0f_9M$*","ReviewerLink":"https://www.cognitoforms.com/Cl√°udioCamozzi/Clientes#5o7SC7U4aG3siN9mpLuGVwB9NJXuSUAB5ml6zNhRcJQ$*","Document1":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=bQwmWYuHEK75bPmKdLTzrIqfXRRj156HC_JnEQI0kyA$","Document2":"https://www.cognitoforms.com/d/HAlBTQyV4kezA48rf0XZiA?code=0zF2cNyuJGIfPNHRrexV2lh_3UsrF59HNUE_gzGQTgA$"},"Id":"51-178"},"webhookUrl":"https://primary-production-70c40.up.railway.app/webhook/8dbc65c7-78f5-484e-8090-bf9046d62290","executionMode":"production"}}]},"versionId":"4f55a595-d662-4da0-94ca-b161fde6ced2","activeVersionId":null,"triggerCount":1,"shared":[{"updatedAt":"2025-09-01T14:56:29.488Z","createdAt":"2025-09-01T14:56:29.488Z","role":"workflow:owner","workflowId":"BgeLnVM9uHTmmMNb","projectId":"BlSED80HESP48veq"}],"activeVersion":null,"tags":[]}