{"updatedAt":"2025-07-10T19:49:59.438Z","createdAt":"2025-06-23T17:19:33.809Z","id":"pcCMiB4b7GmpO8HD","name":"AGENTE INPI","active":true,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-280,-60],"id":"268e4d60-541b-4567-aa23-a2bcaf802dbf","name":"When chat message received","webhookId":"58cb5015-9f29-4447-86bf-e0acb40cc15f"},{"parameters":{"promptType":"define","text":"={{ $json.body.message }}","options":{"systemMessage":"VOCÊ É UM ESPECIALISTA EM CONSULTA DE MARCAS DO INPI\n\n=== INSTRUÇÕES PRINCIPAIS ===\n\nSua função é consultar a base de dados vetorizada das revistas do INPI para verificar disponibilidade de marcas e localizar processos específicos.\n\n=== ESTRATÉGIA DE BUSCA ===\n\nPARA NÚMEROS DE PROCESSO:\n1. SEMPRE faça múltiplas tentativas de busca:\n   - Busque o número EXATO como digitado pelo usuário\n   - Busque apenas os dígitos (sem pontos, barras, espaços)\n   - Busque com formatação padrão INPI (ex: 908423284 E também 90.842.3284)\n   - Use threshold MUITO BAIXO (0.1-0.3) para números de processo\n\n2. Busque em TODOS os campos disponíveis:\n   - Campo \"content\" \n   - Campo \"metadata\"\n   - Qualquer campo que contenha informações do processo\n\nPARA NOMES DE MARCAS:\n1. Realize estas buscas sequenciais:\n   - Busca exata pelo nome digitado\n   - Busca sem acentos e caracteres especiais\n   - Busca em maiúsculas E minúsculas\n   - Busca por palavras individuais da marca\n   - Busca fonética (sons similares)\n\n2. Configure thresholds progressivos:\n   - Primeira busca: threshold 0.9 (muito similar)\n   - Segunda busca: threshold 0.7 (moderadamente similar)\n   - Terceira busca: threshold 0.5 (levemente similar)\n\n=== FORMATO DE RESPOSTA ===\n\nPARA PROCESSOS ENCONTRADOS:\n- Número do processo\n- Nome da marca\n- Classe Nice\n- Status atual (deferido/indeferido/em análise)\n- Data de depósito/registro\n- Titular\n\nPARA CONSULTA DE DISPONIBILIDADE:\n- Status: DISPONÍVEL / INDISPONÍVEL / RISCO\n- Marcas conflitantes encontradas\n- Nível de risco: BAIXO/MÉDIO/ALTO\n- Recomendação legal específica\n\n=== IMPORTANTE ===\n- NUNCA responda \"não encontrado\" sem fazer pelo menos 3 tentativas de busca diferentes\n- SEMPRE explique quantas buscas você fez e com quais termos\n- Se realmente não encontrar, peça ao usuário para verificar se o número/nome está correto\n- Para números de processo, eles SEMPRE devem existir se foram fornecidos corretamente\n\nEXECUTE SEMPRE MÚLTIPLAS BUSCAS ANTES DE CONCLUIR QUE ALGO NÃO EXISTE!"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-60,-60],"id":"409b1921-3b39-4c5f-a06f-05d1ed1269b0","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-100,140],"id":"6883dc5d-4541-4648-823b-9a08d3bb10ed","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.user_id }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[40,140],"id":"3c15745d-c26a-4f8f-9c3d-1d225fb28582","name":"Simple Memory"},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"BUSQUE ESSA BASE DE DADOS PARA PROCESSAR AS PERGUNTAS DO USUARIO","tableName":{"__rl":true,"value":"revistas_inpi","mode":"list","cachedResultName":"revistas_inpi"},"options":{"queryName":"revistas_inpi"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[360,200],"id":"7e592c65-8218-4e74-9503-b8c9dc511429","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"ZHIMmNbYxUlvBiKp","name":"teste-vector"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[440,420],"id":"62b9e53f-feae-40d2-9c47-c0c2268f580c","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{"path":"b25b9814-8090-4127-818e-632581ad0463"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":1.1,"position":[600,-60],"id":"c545efec-49fb-4530-8601-19ecdfc35961","name":"MCP Server Trigger","webhookId":"b25b9814-8090-4127-818e-632581ad0463"},{"parameters":{"httpMethod":"POST","path":"56ce684a-1085-4ea0-a597-de13875d9630","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-280,-280],"id":"0e956ca9-4d7c-4745-8437-c58643bb3778","name":"Webhook","webhookId":"56ce684a-1085-4ea0-a597-de13875d9630"},{"parameters":{"options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[260,-280],"id":"0fa2457a-ce9d-4294-b7e6-355a8a7be4e7","name":"Respond to Webhook"}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0},{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"primary-production-70c40.up.railway.app","user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","content-length":"204","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7","content-type":"application/json","origin":"http://localhost:8080","priority":"u=1, i","referer":"http://localhost:8080/","sec-ch-ua":"\"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"138\", \"Google Chrome\";v=\"138\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"Windows\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","x-forwarded-for":"189.5.177.16","x-forwarded-host":"primary-production-70c40.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4-eqdc4a","x-railway-request-id":"bY-QF9yvQz2bBQ_WCx5-qw","x-real-ip":"189.5.177.16","x-request-start":"1752176879673"},"params":{},"query":{},"body":{"message":"quero registrar a marca SOFTBOSS","user_id":"6535b11d-84b2-4a08-8786-683ee0d08024","agent_id":"a463bf7d-7b24-4abd-87a1-f19b2e7982f9","agent_name":"INPI","timestamp":"2025-07-10T19:47:55.140Z"},"webhookUrl":"https://primary-production-70c40.up.railway.app/webhook/56ce684a-1085-4ea0-a597-de13875d9630","executionMode":"production"}}]},"versionId":"5c27203e-7187-467a-b246-fd35d0cef10e","activeVersionId":"5c27203e-7187-467a-b246-fd35d0cef10e","triggerCount":3,"shared":[{"updatedAt":"2025-06-23T17:19:33.809Z","createdAt":"2025-06-23T17:19:33.809Z","role":"workflow:owner","workflowId":"pcCMiB4b7GmpO8HD","projectId":"BlSED80HESP48veq"}],"activeVersion":{"updatedAt":"2025-12-01T11:56:54.083Z","createdAt":"2025-12-01T11:56:54.083Z","versionId":"5c27203e-7187-467a-b246-fd35d0cef10e","workflowId":"pcCMiB4b7GmpO8HD","nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-280,-60],"id":"268e4d60-541b-4567-aa23-a2bcaf802dbf","name":"When chat message received","webhookId":"58cb5015-9f29-4447-86bf-e0acb40cc15f"},{"parameters":{"promptType":"define","text":"={{ $json.body.message }}","options":{"systemMessage":"VOCÊ É UM ESPECIALISTA EM CONSULTA DE MARCAS DO INPI\n\n=== INSTRUÇÕES PRINCIPAIS ===\n\nSua função é consultar a base de dados vetorizada das revistas do INPI para verificar disponibilidade de marcas e localizar processos específicos.\n\n=== ESTRATÉGIA DE BUSCA ===\n\nPARA NÚMEROS DE PROCESSO:\n1. SEMPRE faça múltiplas tentativas de busca:\n   - Busque o número EXATO como digitado pelo usuário\n   - Busque apenas os dígitos (sem pontos, barras, espaços)\n   - Busque com formatação padrão INPI (ex: 908423284 E também 90.842.3284)\n   - Use threshold MUITO BAIXO (0.1-0.3) para números de processo\n\n2. Busque em TODOS os campos disponíveis:\n   - Campo \"content\" \n   - Campo \"metadata\"\n   - Qualquer campo que contenha informações do processo\n\nPARA NOMES DE MARCAS:\n1. Realize estas buscas sequenciais:\n   - Busca exata pelo nome digitado\n   - Busca sem acentos e caracteres especiais\n   - Busca em maiúsculas E minúsculas\n   - Busca por palavras individuais da marca\n   - Busca fonética (sons similares)\n\n2. Configure thresholds progressivos:\n   - Primeira busca: threshold 0.9 (muito similar)\n   - Segunda busca: threshold 0.7 (moderadamente similar)\n   - Terceira busca: threshold 0.5 (levemente similar)\n\n=== FORMATO DE RESPOSTA ===\n\nPARA PROCESSOS ENCONTRADOS:\n- Número do processo\n- Nome da marca\n- Classe Nice\n- Status atual (deferido/indeferido/em análise)\n- Data de depósito/registro\n- Titular\n\nPARA CONSULTA DE DISPONIBILIDADE:\n- Status: DISPONÍVEL / INDISPONÍVEL / RISCO\n- Marcas conflitantes encontradas\n- Nível de risco: BAIXO/MÉDIO/ALTO\n- Recomendação legal específica\n\n=== IMPORTANTE ===\n- NUNCA responda \"não encontrado\" sem fazer pelo menos 3 tentativas de busca diferentes\n- SEMPRE explique quantas buscas você fez e com quais termos\n- Se realmente não encontrar, peça ao usuário para verificar se o número/nome está correto\n- Para números de processo, eles SEMPRE devem existir se foram fornecidos corretamente\n\nEXECUTE SEMPRE MÚLTIPLAS BUSCAS ANTES DE CONCLUIR QUE ALGO NÃO EXISTE!"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-60,-60],"id":"409b1921-3b39-4c5f-a06f-05d1ed1269b0","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-100,140],"id":"6883dc5d-4541-4648-823b-9a08d3bb10ed","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.user_id }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[40,140],"id":"3c15745d-c26a-4f8f-9c3d-1d225fb28582","name":"Simple Memory"},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"BUSQUE ESSA BASE DE DADOS PARA PROCESSAR AS PERGUNTAS DO USUARIO","tableName":{"__rl":true,"value":"revistas_inpi","mode":"list","cachedResultName":"revistas_inpi"},"options":{"queryName":"revistas_inpi"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[360,200],"id":"7e592c65-8218-4e74-9503-b8c9dc511429","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"ZHIMmNbYxUlvBiKp","name":"teste-vector"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[440,420],"id":"62b9e53f-feae-40d2-9c47-c0c2268f580c","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{"path":"b25b9814-8090-4127-818e-632581ad0463"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":1.1,"position":[600,-60],"id":"c545efec-49fb-4530-8601-19ecdfc35961","name":"MCP Server Trigger","webhookId":"b25b9814-8090-4127-818e-632581ad0463"},{"parameters":{"httpMethod":"POST","path":"56ce684a-1085-4ea0-a597-de13875d9630","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-280,-280],"id":"0e956ca9-4d7c-4745-8437-c58643bb3778","name":"Webhook","webhookId":"56ce684a-1085-4ea0-a597-de13875d9630"},{"parameters":{"options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[260,-280],"id":"0fa2457a-ce9d-4294-b7e6-355a8a7be4e7","name":"Respond to Webhook"}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0},{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}