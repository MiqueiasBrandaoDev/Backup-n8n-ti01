{"updatedAt":"2025-08-08T14:20:04.836Z","createdAt":"2025-08-08T13:32:10.403Z","id":"nLRvtCaiDWyIRmKH","name":"MCP Orquestrador","active":true,"isArchived":false,"nodes":[{"parameters":{"path":"71182e76-e37c-43f7-86c8-5770dbc03e27"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[-144,-240],"id":"f75b95d8-2f56-4084-8b97-00a0af9773b4","name":"MCP Server Trigger","webhookId":"71182e76-e37c-43f7-86c8-5770dbc03e27"},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"=Repositório vetorial que armazena embeddings semânticos de marcas registradas extraídas das revistas do INPI. Utilizado pelo agente RAG para recuperar documentos juridicamente relevantes com base em similaridade contextual. Otimizado com reranking via Cohere e embeddings text-embedding-3-large da OpenAI. Fonte primária de consulta para validação e análise inteligente de marcas no processo de due diligence.","tableName":{"__rl":true,"value":"inpi_marcas","mode":"list","cachedResultName":"inpi_marcas"},"topK":20,"useReranker":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[592,448],"id":"5a98846f-a10e-4a5c-a6ba-24747925ca6c","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"owOefRPznkDGtaj3","name":"INPI - RAG"}}},{"parameters":{"operation":"getAll","tableId":"inpi_marcas","returnAll":true,"filters":{"conditions":[{"keyName":"marca_nome","condition":"ilike","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"},{"keyName":"classes_nice","condition":"ilike","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Field_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[32,560],"id":"00ea4d1a-94f7-4340-aecf-d55ba0eef70f","name":"Query Marca","credentials":{"supabaseApi":{"id":"owOefRPznkDGtaj3","name":"INPI - RAG"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[640,656],"id":"32f8a981-c2c9-4e8b-8df5-97e637bee712","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[800,656],"id":"b55987cf-fd24-47a0-aaff-5019c523399c","name":"Reranker Cohere","credentials":{"cohereApi":{"id":"JUhw1jVVzyS2hZQw","name":"CohereApi account"}}},{"parameters":{"text":"Você é um agente SQL especializado em consultar registros de marca no INPI de forma exata. Você possui acesso a uma base estruturada com:\n\n- Nome da marca\n- Número do processo\n- Situação (registrada, indeferida, etc)\n- Classe\n- Titular\n\nEntrada:\n- Nome da marca (obrigatório)\n- Classe (opcional)\n\nSua função é buscar todas as marcas com nome igual ou muito parecido e retornar:\n\n- Nome da marca\n- Classe\n- Status (situacao)\n- Número do processo\n- Titular\n\nFormato da resposta:\n- Tabela com os registros encontrados\n- Conclusão clara: se a marca está registrada em alguma classe ou não\n\nSe não encontrar nenhuma entrada, retorne:\n> \"Nenhuma marca com esse nome foi encontrada no banco de dados. Pode estar disponível para registro.\"\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[-96,256],"id":"2a2f9365-6877-4793-b512-a2d11da44d53","name":"AI Agent Query"},{"parameters":{"text":"=Você é um agente especialista em consulta semântica de marcas no INPI. Sua tarefa é retornar registros similares, históricos e insights com base na intenção do usuário.\n\nEntrada:\n- Nome da marca (obrigatório)\n- Classe (opcional)\n\nAja mesmo se a classe não for fornecida.\n\nRetorne:\n- Registros similares semanticamente à marca consultada\n- Informações de contexto (ex: se marcas similares já foram negadas, aprovadas ou canceladas)\n- Classes onde existem registros parecidos\n- Insights sobre a possibilidade de registro\n- Sugestões de cuidados com possíveis conflitos\n\nFormato da resposta:\n- Lista de marcas semelhantes encontradas (com nome, status, classe)\n- Conclusão sobre viabilidade de registro\n\nSe nada for encontrado, retorne:  \n> \"Nenhuma marca similar foi encontrada. Isso pode indicar uma boa chance de registro.\"\n\nSe encontrar conflitos em algumas classes, retorne:  \n> \"A marca possui registros similares nas classes X e Y. Verifique se há espaço em outras classes relacionadas.\"\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[528,256],"id":"29a1aabc-8839-458d-bbfc-2fb886968de2","name":"AI Agent Query1"},{"parameters":{"text":"=Você é um agente orquestrador responsável por coordenar a consulta de disponibilidade de uma marca no INPI. O usuário pode fornecer:\n\n- Somente o nome da marca\n- Somente a classe\n- Ambos\n- Ou nenhum, apenas uma intenção genérica\n\nSeu trabalho é:\n\n1. Entender a intenção do usuário: ele quer consultar a disponibilidade de uma marca para registro no INPI.\n2. Verificar se o usuário mencionou uma marca (ex: \"Quero consultar a marca TSI\") ou uma classe (ex: \"Tem algo na classe 25?\").\n3. Se o usuário mencionou apenas a marca, prossiga com a consulta mesmo sem classe — pergunte se quiser, mas **não bloqueie a resposta**.\n4. Se o usuário mencionou marca e classe, passe essas duas informações para os agentes especialistas.\n5. Sempre acione os dois agentes abaixo com o que você tiver de informação:\n   - **Agente SQL**: retorna resultados exatos por nome e/ou classe.\n   - **Agente RAG**: retorna dados semânticos, registros semelhantes, nomes parecidos, histórico e contexto.\n6. Combine as respostas e monte um resumo inteligente:\n   - Se a marca foi encontrada em alguma classe, informe que ela já está registrada nessas classes e sugira outras possíveis classes livres.\n   - Se a marca **não foi encontrada**, diga que está disponível para registro.\n   - Se a classe foi mencionada, traga dados da marca dentro dessa classe.\n   - Se **não** houver marca nem classe, pergunte de forma objetiva o que a pessoa deseja verificar.\n\nSeja objetivo, claro e com tom profissional. Priorize **responder com o que tiver** ao invés de pedir mais detalhes.\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[-64,-32],"id":"7ef352b1-d1be-4827-a1fc-2ddb063b7088","name":"AI Agent Tool"},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-720,624],"id":"2b6417dc-a0d2-4180-b335-c6cd79e4792f","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"693RMMU9iQU2ZLhc","name":"Agno"}}},{"parameters":{"content":"### MEMÓRIA","height":576,"width":224,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-528,208],"typeVersion":1,"id":"da857bb6-6117-4eab-814b-e4363c69741e","name":"Sticky Note"},{"parameters":{"content":"### AGENTE QUERY","height":576,"width":624,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-288,208],"typeVersion":1,"id":"39e051a0-569d-4156-be4a-5da06dfacd08","name":"Sticky Note1"},{"parameters":{"content":"### AGENTE RAG","height":576,"width":624,"color":6},"type":"n8n-nodes-base.stickyNote","position":[352,208],"typeVersion":1,"id":"2a7b9396-8d22-4ad1-8518-1d633c7c0de5","name":"Sticky Note2"},{"parameters":{"sessionIdType":"customKey","sessionKey":"22","sessionTTL":10,"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.5,"position":[-464,624],"id":"b333d90d-5bf5-4d58-b050-3b5b19d79806","name":"Redis Chat Memory","credentials":{"redis":{"id":"1f7hNvPJVM2bjGpi","name":"Redis account"}}},{"parameters":{"content":"### MODELO","height":576,"width":224,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-768,208],"typeVersion":1,"id":"d2c975e8-3e13-496b-8919-d3d3f29c4695","name":"Sticky Note3"}],"connections":{"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent Query1","type":"ai_tool","index":0}]]},"Query Marca":{"ai_tool":[[{"node":"AI Agent Query","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Reranker Cohere":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]},"AI Agent Query":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"AI Agent Query1":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"AI Agent Tool":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent Tool","type":"ai_languageModel","index":0},{"node":"AI Agent Query1","type":"ai_languageModel","index":0},{"node":"AI Agent Query","type":"ai_languageModel","index":0}]]},"Redis Chat Memory":{"ai_memory":[[{"node":"AI Agent Tool","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"5fff5429-5d0c-4d57-9250-82f59bec09fc","activeVersionId":"5fff5429-5d0c-4d57-9250-82f59bec09fc","triggerCount":1,"shared":[{"updatedAt":"2025-08-08T13:32:10.403Z","createdAt":"2025-08-08T13:32:10.403Z","role":"workflow:owner","workflowId":"nLRvtCaiDWyIRmKH","projectId":"BlSED80HESP48veq"}],"activeVersion":{"updatedAt":"2025-12-01T11:56:54.083Z","createdAt":"2025-12-01T11:56:54.083Z","versionId":"5fff5429-5d0c-4d57-9250-82f59bec09fc","workflowId":"nLRvtCaiDWyIRmKH","nodes":[{"parameters":{"path":"71182e76-e37c-43f7-86c8-5770dbc03e27"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[-144,-240],"id":"f75b95d8-2f56-4084-8b97-00a0af9773b4","name":"MCP Server Trigger","webhookId":"71182e76-e37c-43f7-86c8-5770dbc03e27"},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"=Repositório vetorial que armazena embeddings semânticos de marcas registradas extraídas das revistas do INPI. Utilizado pelo agente RAG para recuperar documentos juridicamente relevantes com base em similaridade contextual. Otimizado com reranking via Cohere e embeddings text-embedding-3-large da OpenAI. Fonte primária de consulta para validação e análise inteligente de marcas no processo de due diligence.","tableName":{"__rl":true,"value":"inpi_marcas","mode":"list","cachedResultName":"inpi_marcas"},"topK":20,"useReranker":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[592,448],"id":"5a98846f-a10e-4a5c-a6ba-24747925ca6c","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"owOefRPznkDGtaj3","name":"INPI - RAG"}}},{"parameters":{"operation":"getAll","tableId":"inpi_marcas","returnAll":true,"filters":{"conditions":[{"keyName":"marca_nome","condition":"ilike","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', ``, 'string') }}"},{"keyName":"classes_nice","condition":"ilike","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Field_Value', ``, 'string') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[32,560],"id":"00ea4d1a-94f7-4340-aecf-d55ba0eef70f","name":"Query Marca","credentials":{"supabaseApi":{"id":"owOefRPznkDGtaj3","name":"INPI - RAG"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[640,656],"id":"32f8a981-c2c9-4e8b-8df5-97e637bee712","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"bEHAhmQV1LUjIUXy","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[800,656],"id":"b55987cf-fd24-47a0-aaff-5019c523399c","name":"Reranker Cohere","credentials":{"cohereApi":{"id":"JUhw1jVVzyS2hZQw","name":"CohereApi account"}}},{"parameters":{"text":"Você é um agente SQL especializado em consultar registros de marca no INPI de forma exata. Você possui acesso a uma base estruturada com:\n\n- Nome da marca\n- Número do processo\n- Situação (registrada, indeferida, etc)\n- Classe\n- Titular\n\nEntrada:\n- Nome da marca (obrigatório)\n- Classe (opcional)\n\nSua função é buscar todas as marcas com nome igual ou muito parecido e retornar:\n\n- Nome da marca\n- Classe\n- Status (situacao)\n- Número do processo\n- Titular\n\nFormato da resposta:\n- Tabela com os registros encontrados\n- Conclusão clara: se a marca está registrada em alguma classe ou não\n\nSe não encontrar nenhuma entrada, retorne:\n> \"Nenhuma marca com esse nome foi encontrada no banco de dados. Pode estar disponível para registro.\"\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[-96,256],"id":"2a2f9365-6877-4793-b512-a2d11da44d53","name":"AI Agent Query"},{"parameters":{"text":"=Você é um agente especialista em consulta semântica de marcas no INPI. Sua tarefa é retornar registros similares, históricos e insights com base na intenção do usuário.\n\nEntrada:\n- Nome da marca (obrigatório)\n- Classe (opcional)\n\nAja mesmo se a classe não for fornecida.\n\nRetorne:\n- Registros similares semanticamente à marca consultada\n- Informações de contexto (ex: se marcas similares já foram negadas, aprovadas ou canceladas)\n- Classes onde existem registros parecidos\n- Insights sobre a possibilidade de registro\n- Sugestões de cuidados com possíveis conflitos\n\nFormato da resposta:\n- Lista de marcas semelhantes encontradas (com nome, status, classe)\n- Conclusão sobre viabilidade de registro\n\nSe nada for encontrado, retorne:  \n> \"Nenhuma marca similar foi encontrada. Isso pode indicar uma boa chance de registro.\"\n\nSe encontrar conflitos em algumas classes, retorne:  \n> \"A marca possui registros similares nas classes X e Y. Verifique se há espaço em outras classes relacionadas.\"\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[528,256],"id":"29a1aabc-8839-458d-bbfc-2fb886968de2","name":"AI Agent Query1"},{"parameters":{"text":"=Você é um agente orquestrador responsável por coordenar a consulta de disponibilidade de uma marca no INPI. O usuário pode fornecer:\n\n- Somente o nome da marca\n- Somente a classe\n- Ambos\n- Ou nenhum, apenas uma intenção genérica\n\nSeu trabalho é:\n\n1. Entender a intenção do usuário: ele quer consultar a disponibilidade de uma marca para registro no INPI.\n2. Verificar se o usuário mencionou uma marca (ex: \"Quero consultar a marca TSI\") ou uma classe (ex: \"Tem algo na classe 25?\").\n3. Se o usuário mencionou apenas a marca, prossiga com a consulta mesmo sem classe — pergunte se quiser, mas **não bloqueie a resposta**.\n4. Se o usuário mencionou marca e classe, passe essas duas informações para os agentes especialistas.\n5. Sempre acione os dois agentes abaixo com o que você tiver de informação:\n   - **Agente SQL**: retorna resultados exatos por nome e/ou classe.\n   - **Agente RAG**: retorna dados semânticos, registros semelhantes, nomes parecidos, histórico e contexto.\n6. Combine as respostas e monte um resumo inteligente:\n   - Se a marca foi encontrada em alguma classe, informe que ela já está registrada nessas classes e sugira outras possíveis classes livres.\n   - Se a marca **não foi encontrada**, diga que está disponível para registro.\n   - Se a classe foi mencionada, traga dados da marca dentro dessa classe.\n   - Se **não** houver marca nem classe, pergunte de forma objetiva o que a pessoa deseja verificar.\n\nSeja objetivo, claro e com tom profissional. Priorize **responder com o que tiver** ao invés de pedir mais detalhes.\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agentTool","typeVersion":2.2,"position":[-64,-32],"id":"7ef352b1-d1be-4827-a1fc-2ddb063b7088","name":"AI Agent Tool"},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-720,624],"id":"2b6417dc-a0d2-4180-b335-c6cd79e4792f","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"693RMMU9iQU2ZLhc","name":"Agno"}}},{"parameters":{"content":"### MEMÓRIA","height":576,"width":224,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-528,208],"typeVersion":1,"id":"da857bb6-6117-4eab-814b-e4363c69741e","name":"Sticky Note"},{"parameters":{"content":"### AGENTE QUERY","height":576,"width":624,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-288,208],"typeVersion":1,"id":"39e051a0-569d-4156-be4a-5da06dfacd08","name":"Sticky Note1"},{"parameters":{"content":"### AGENTE RAG","height":576,"width":624,"color":6},"type":"n8n-nodes-base.stickyNote","position":[352,208],"typeVersion":1,"id":"2a7b9396-8d22-4ad1-8518-1d633c7c0de5","name":"Sticky Note2"},{"parameters":{"sessionIdType":"customKey","sessionKey":"22","sessionTTL":10,"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.5,"position":[-464,624],"id":"b333d90d-5bf5-4d58-b050-3b5b19d79806","name":"Redis Chat Memory","credentials":{"redis":{"id":"1f7hNvPJVM2bjGpi","name":"Redis account"}}},{"parameters":{"content":"### MODELO","height":576,"width":224,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-768,208],"typeVersion":1,"id":"d2c975e8-3e13-496b-8919-d3d3f29c4695","name":"Sticky Note3"}],"connections":{"Supabase Vector Store":{"ai_tool":[[{"node":"AI Agent Query1","type":"ai_tool","index":0}]]},"Query Marca":{"ai_tool":[[{"node":"AI Agent Query","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Reranker Cohere":{"ai_reranker":[[{"node":"Supabase Vector Store","type":"ai_reranker","index":0}]]},"AI Agent Query":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"AI Agent Query1":{"ai_tool":[[{"node":"AI Agent Tool","type":"ai_tool","index":0}]]},"AI Agent Tool":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent Tool","type":"ai_languageModel","index":0},{"node":"AI Agent Query1","type":"ai_languageModel","index":0},{"node":"AI Agent Query","type":"ai_languageModel","index":0}]]},"Redis Chat Memory":{"ai_memory":[[{"node":"AI Agent Tool","type":"ai_memory","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}